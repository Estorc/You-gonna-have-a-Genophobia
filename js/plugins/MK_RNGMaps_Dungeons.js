/*:
 * @target MZ
 * @plugindesc 1.63 Aero's Random Dungeon Generator
 * @author Aerosys
 * @url https://aerosys.blog
 * @
 * 
 * 
 * =====================================================================================
 * COMMANDS
 * =====================================================================================
 *
 * @command borderWidth
 * @text (optional) Set Border Width
 * @desc Change the size of the margin of the generated Map
 *
 * @arg value
 * @type Number
 * @default 1
 * 
 * @command Create Classical Maze
 * @desc Start generating a Maze using the Prims algorithm
 *
 * @command Create Maze with Finetuning
 * @desc Start generating a Maze with optional parameters.
 *
 * @arg cutOffDeadEnds
 * @text Cut off Dead Ends
 * @desc Dead Ends are removed to create blank Tiles. Value is number of iterations.
 * @type Number
 * @default 2
 *
 * @arg mergeDeadEnds
 * @text Merge Dead Ends
 * @desc Chance that a new Tunnel is created from a Dead End back to the Maze. Will lead to imperfect Maze.
 * @type Number
 * @default 0.5
 *
 * @arg mode
 * @desc You can define the order of cut off first, then merge Dead Ends, or the other way round.
 * @type select
 * @option Cut off, then Merge
 * @option Merge, then Cut off
 * @default Cut off, then Merge
 *
 * @command Create Dungeon using Random Walk
 * @desc Start generating a Cave-like Dungeon allowing large Areas
 *
 * @arg Start
 * @type select
 * @option top
 * @option left
 * @option right
 * @option bottom
 * @default bottom
 *
 * @arg End
 * @type select
 * @option top
 * @option left
 * @option right
 * @option bottom
 * @default top
 *
 * @arg allowRevisit
 * @text allow Revisit
 * @desc Define, if the Random Walk algorithm is allowed to revisit a Place that he has already visited.
 * @type boolean
 * @default true
 *
 * @command createRoad
 * @text Create Road
 * @desc Start generating a (Forest) Road
 *
 * @arg Start
 * @type select
 * @option top
 * @option left
 * @option right
 * @option bottom
 * @default bottom
 *
 * @arg End
 * @type select
 * @option top
 * @option left
 * @option right
 * @option bottom
 * @default top
 *
 * @command placeEntrance
 * @text Place Entrance
 * @desc Place the Entrance
 *
 * @arg Position
 * @type select
 * @option any
 * @option top
 * @option left
 * @option right
 * @option bottom
 * @default bottom
 *
 * @command placeExit
 * @text Place Exit
 * @desc Place the Exit
 *
 * @arg Position
 * @type select
 * @option any
 * @option top
 * @option left
 * @option right
 * @option bottom
 * @default top
 *
 * @command spawnPlayerAt
 * @text (optional) Spawn Player at Region Id
 * @desc When you want the Player to spawn at a different Region Id
 *
 * @arg direction
 * @type select
 * @option any
 * @option top
 * @option left
 * @option right
 * @option bottom
 * @default any
 *
 * @arg regionId
 * @text Region Id
 * @type Number
 * @default 6 
 *
 * @command drawDecorations
 * @text Draw Decorations
 * @desc Draw Assets that are drawn on the Decoration Map
 *
 * @arg Ids
 * @desc comma-separated list of Decoration Ids. If empty, draw all Decorations.
 *
 * @command drawDecorationXTimes
 * @text Draw Decoration X Times
 * @desc Draw a specific Asset X times on the Map
 *
 * @arg Id
 * @type Number
 * @desc Id of the Decoration you want to draw.
 *
 * @arg min
 * @type Number
 * @default 1
 * @desc Minimum Number that the Asset should be drawn.
 *
 * @arg max
 * @type Number
 * @default 1
 * @desc Maximum Number that the Asset should be drawn.
 *
 * @command finalize
 * @text Finalize
 * @desc Call this Function at the end.
 * 
 * 
 * =====================================================================================
 * PARAMS
 * =====================================================================================
 * 
 * @param entranceRegionId
 * @text Entrance Region Id
 * @type number
 * @desc Region Id to define Entrance location
 * @default 5
 *
 * @param playerSpawningPointRegionId
 * @text Player Spawning Point Region Id
 * @type number
 * @desc Region Id to define where the Player spawns when he is transferred towards a generated Map
 * @default 6
 *
 * @param exitRegionId
 * @text Exit Region Id
 * @type number
 * @desc Region Id to define Exit location
 * @default 13
 *
 * @param decorationStopperId
 * @text Decoration Stopper Id
 * @type number
 * @desc Region Id to determine the last object in your decoration map
 * @default 61
 *
 * @param defaultBorderWidth
 * @text Default Border Width
 * @type number
 * @default 1
 * @desc Space which is kept between the manipulated area and the borders
 * 
 * 
 * =====================================================================================
 * HELP
 * =====================================================================================
 *
 * @help
 * contact
 * --------
 * Aerosys at rpgmaker web forums
 *
 * Requirements (in this order)
 * ----------------------------
 * none
 *
 * T&C
 * ----------------------------
 * Credit Aerosys, Lantiz / Biterkid
 * Full T&C in the forums and on my website
 *
 * Instructions and T&C at aerosys.blog
 * Please visit the rpgmakerweb forum to give feedback :)
 * 
 */

'use strict';

var MK = MK || {};
MK.alias = MK.alias || {};

var params = PluginManager.parameters('MK_RNGMaps_Dungeons');
MK.ENTRANCE_REGION_ID           = Number(params.entranceRegionId);
MK.SPAWNING_POINT_REGION_ID     = Number(params.playerSpawningPointRegionId);
MK.EXIT_REGION_ID               = Number(params.exitRegionId);
MK.DECORATION_STOPPER_ID        = Number(params.decorationStopperId);
MK.DEFAULT_BORDER_WIDTH         = Number(params.defaultBorderWidth);

var Imported = Imported || {};
Imported.MK_RNGMaps_Dungeons = true;

// =====================================================================================
// 3rd Party Plugin Support
// =====================================================================================

MK.mv3d = typeof mv3d !== 'undefined';
MK.mz3d = typeof mz3d !== 'undefined';

MK.thirdPartySupport = { };

MK.thirdPartySupport.beforeMapLoaded = function() {
    const mapId = $gameMap.mapId();

    // MV3D & MZ3D
    if (typeof mv3d !== 'undefined' && !MK.mv3d)
        throw Error("MV3D must be ordered BEFORE RNGMaps in the Plugin Manager");
    if (typeof mz3d !== 'undefined' && !MK.mz3d)
        throw Error("MZ3D must be ordered BEFORE RNGMaps in the Plugin Manager");
    
    if (typeof mv3d !== 'undefined') {
        mv3d.mapReady = false;
        mv3d.needClearMap = true;
        mv3d.mapLoaded = false;
    }
    if (typeof mz3d !== 'undefined') {
        mz3d.mapReady = false;
        mz3d.needClearMap = true;
        mz3d.mapLoaded = false;
    }
    
    // Alpha ABS
    if (typeof AlphaABS !== 'undefined') {
        AlphaABS.BattleManagerABS._isABSMap = false;
    }

    // AltimitMovement
    if ($gameSystem._eventColliders && $gameSystem._eventColliders[mapId]) {
        $gameSystem._eventColliders[mapId] = [];
    }
    const cacheName = 'cache_mesh%1'.format(mapId.padZero(3))
    if (StorageManager.exists(cacheName)) {
        StorageManager.remove(cacheName);
    }
}

MK.thirdPartySupport.afterMapLoaded = function() {
    // not used at the moment
}

// =====================================================================================
// MK methods
// =====================================================================================

MK.array = function(n, initialValue) {
    const array = new Array(n);
    initialValue = initialValue || 0;
    for (let i = 0; i < n; i++) { array[i] = initialValue; }
    return array;
}

MK.arrange = function(n) {
    const toReturn = MK.array(n);
    for (let i = 0; i < n; i++) { toReturn[i] = i; }
    return toReturn;
}

MK.createMatrix = function(w, h, initialValue) {
    return MK.arrange(w).map(_ => MK.array(h, initialValue));
}

MK.matrixForEach = function(matrix, f) {
    for (let x = 0; x < matrix.length; x++) {
        for (let y = 0; y < matrix[x].length; y++) {
            matrix[x][y] = f(x, y);
        }
    }
    return matrix;
}

MK.validNumbers = function(...numbers) {
    return numbers && numbers.length > 0 && numbers.every(n => !!n);
}

MK.hashNumbers = function(...values) {
    
    if (!MK.validNumbers(values))
        throw Error("FATAL: hashNumbers invalid argument(s): " + values);
    
    let result = 1;
    for (let value of values) {
        result = (31 * result + value) % 2347;
    }
    return result % 2347;
}

MK.requireNonNull = function(object, functionName, argumentName) {
    if (!object)
        throw Error("Function Call \"" + functionName + "\" missing argument: " + argumentName);
}

MK.requireType = function(object, type, functionName, argumentName) {
    if (typeof object !== type)
        throw Error("Function Call \""
            + functionName
            + "\" argument \""
            + argumentName
            + "\" must be type "
            + type
            + " but was "
            + typeof object 
            + " (" + object + ")"
        )
}

MK.requireToBeOneOfThese = function(object, values, functionName, argumentName) {
    if (!values.contains(object))
        throw Error("Function Call \""
            + functionName
            + "\" argument \""
            + argumentName
            + "\" must be one of these: "
            + values
            + ", but was: "
            + object);
}

// Alias
MK.alias.event = Game_Event.prototype.event;
Game_Event.prototype.event = function() {
    const toReturn = MK.alias.event.call(this);

    if (0) {
        console.log("$dataMap.events -> ");
        console.log($dataMap.events);
        console.log("$gameMap.events() -> ");
        console.log($gameMap.events());
        console.log("$gameMap._events -> ");
        console.log($gameMap._events);

        throw Error ("FATAL: Wanted to access Event '" + this._eventId
            + "' but it does not exist in $dataMap.events!\n"
            + "Open Debug Console for details.");
    }
    return toReturn;
};

MK.onUsePremiumFunctionAlert = function(functionName) {
    alert("You called the function \""
        + functionName
        + "\" that is available in the Full Version only, "
        + "maybe by copy-pasting a Javascript snippet or you just forgot to import the required Plugin."
        + "\n\nPlease add MK_RNGMaps_Addons to enable this function");
    SceneManager.exit();
}


// =====================================================================================
// DataManager
// =====================================================================================

MK.additionalMaps   = {};
MK.n_mapsLoading    = 0;

MK.injectDataMap = function(dataMap, spawnX, spawnY) {
    
    if (!dataMap) throw Error("FATAL: dataMap required!");
    spawnX = spawnX || $gamePlayer.x;
    spawnY = spawnY || $gamePlayer.y;
    const mapId = $gameMap.mapId();

    MK.isInjectingMap   = true;
    MK.injectedMapId    = mapId;
    MK.injectedDataMap  = dataMap;
    MK.requestMapRefresh();
    
    $gamePlayer.requestMapReload();
    $gameMap.requestRefresh();
    $gameMap.MK_clearEvents();
    $gamePlayer.reserveTransfer(mapId, spawnX, spawnY, 0, 2);
}

// Alias
MK.alias.loadMapData = DataManager.loadMapData;
DataManager.loadMapData = function(mapId) {
    
    if (MK.injectedMapId != mapId) {
        // leave Area
        MK.injectedMapId = null;
        MK.injectedDataMap = null;
    }
    if ($dungeonGenerator.mapId != mapId) {
        $dungeonGenerator.leaveRNGArea();
    }
    MK.alias.loadMapData.call(this, mapId);
    MK.loadChildMaps(mapId);
}

MK.alias.onMapLoaded = Scene_Map.prototype.onMapLoaded;
Scene_Map.prototype.onMapLoaded = function() {
    
    if (MK.injectedDataMap) {
        $dataMap = MK.injectedDataMap;
        $gameMap.updateAllAutoTiles();
    }
    
    if (MK.isMapRefreshRequired())
        MK.thirdPartySupport.beforeMapLoaded();
    
    MK.alias.onMapLoaded.call(this);

    if (MK.isMapRefreshRequired())
        MK.thirdPartySupport.afterMapLoaded();
    
    MK._isRefreshRequired = false;
}

MK.requestMapRefresh = function() {
    this._isRefreshRequired = true;
}

MK.isMapRefreshRequired = function() {
    return !!this._isRefreshRequired;
}

MK.loadChildMaps = function(mapId) {
    
    if (!mapId) throw Error("Fatal: no MapId given!");
    
    MK.additionalMaps = {};

    function getParentId() {
        const mapInfo = $dataMapInfos.find(mapInfo => mapInfo && mapInfo.id == mapId);
        return mapInfo && mapInfo.parent ? mapInfo.parent : 0;
    }

    const parentId = getParentId();
    const additionalMapIds = $dataMapInfos
        .filter(mapInfo => mapInfo)
        .filter(mapInfo => [mapId, parentId].contains(mapInfo.parentId))
        .filter(mapInfo => MK.isMapIncluded(mapInfo.name));
    
    for (let mapInfo of additionalMapIds) {
        MK.loadAdditionalMap(mapInfo.name.toLowerCase(), mapInfo.id);
    }
}

MK.isMapIncluded = function(name) {
    return name.toLowerCase().startsWith("snippets") || name.toLowerCase().startsWith("dec");
}

MK.loadAdditionalMap = function(name, mapId) {
	const xhr = new XMLHttpRequest();
	const url = 'data/Map%1.json'.format(mapId.padZero(3));
	xhr.open('GET', url);
	xhr.overrideMimeType('application/json');
	xhr.onload = function() {
		if (xhr.status < 400) {
            var data = JSON.parse(xhr.responseText);
            data.isAdditionalMap = true;
            
            data.events
                .filter(e => e && 'note' in e)
                .forEach(e => DataManager.extractMetadata(e));
            
            MK.additionalMaps[name] = data;
            MK.n_mapsLoading -= 1;
		}
	}
	xhr.onerror = this._mapLoader || function() {
		DataManager._errorUrl = DataManager._errorUrl || url;
	}
	MK.additionalMaps[name] = null;
	MK.n_mapsLoading++;
	xhr.send();
};

// Alias
MK.alias.isMapLoaded = DataManager.isMapLoaded;
DataManager.isMapLoaded = function() {
	return MK.alias.isMapLoaded.call(this)
        && MK.n_mapsLoading == 0;
};

MK.maps = { };

MK.getMapFromDisk = function(mapId) {
    mapId = mapId || $gameMap.mapId();
    
    if (MK.maps[mapId]) return JsonEx.makeDeepCopy(MK.maps[mapId]);

    MK.maps[mapId] = MK.loadMapSync(mapId);
    return JsonEx.makeDeepCopy(MK.maps[mapId]);
}

MK.loadMapSync = function(mapId) {
    const xhr = new XMLHttpRequest();
	const url = 'data/Map%1.json'.format(mapId.padZero(3));
    xhr.open('GET', url, false);
	xhr.overrideMimeType('application/json');
	xhr.send(null);
    
    const data = JSON.parse(xhr.responseText);
    DataManager.extractMetadata(data);
    data.events
        .filter(e => e && 'note' in e)
        .forEach(e => DataManager.extractMetadata(e));
    return data;
}


// =====================================================================================
// Game_Map
// =====================================================================================
Game_Map.prototype.tileIndex = function(x, y, z) {
    return (z * this.height() + y) * this.width() + x;
}

Game_Map.prototype.MK_clearEvents = function() {
    this.events().filter(e => !!e).forEach(event => event.erase());
}

Game_Map.prototype.MK_applyLoops = function(x, y) {
    
    // don't do modulo, it sucks with negative numbers
    if (this.isLoopHorizontal() && x < 0)              x = this.width() - 1;
    if (this.isLoopHorizontal() && x >= this.width())  x = 0;
    if (this.isLoopVertical()   && y < 0)              y = this.height() - 1;
    if (this.isLoopVertical()   && y >= this.height()) y = 0;
    return [x, y];
}

/*
 * returns FALSE when other autotile is same as given one, TRUE otherwise
 */
Game_Map.prototype.autotileEdge = function(autotile, x, y, z) {
    
    x = this.MK_applyLoops(x, y)[0];
    y = this.MK_applyLoops(x, y)[1];

    return this.isValid(x, y) && autotile != this.autotileType(x, y, z);
}

Game_Map.prototype.autotileWaterEdge = function(autotile, x, y, z) {
    
    x = this.MK_applyLoops(x, y)[0];
    y = this.MK_applyLoops(x, y)[1];

    if (!this.isValid(x, y))
        return false;
    
    // check water & waterfall
    var isWater     = this.isWater(autotile);
    var isWaterfall = this.isWaterfall(this.autotileType(x, y, z));
    
    return (isWater && isWaterfall) || autotile != this.autotileType(x, y, z);
};

/*
 * returns FALSE when other autotile is same as given one, TRUE otherwise
 */
Game_Map.prototype.autotileWallEdge = function(autotile, source_x, source_y, x, y, z) {
    
    source_x    = this.MK_applyLoops(source_x, source_y)[0];
    source_y    = this.MK_applyLoops(source_x, source_y)[1];
    x           = this.MK_applyLoops(x, y)              [0];
    y           = this.MK_applyLoops(x, y)              [1];

    if (!this.isValid(x, y))
        return false;
    
    var is_different    = this.autotileEdge(autotile, x, y, z);
    var is_top          = autotile - 8 == this.autotileType(x, y, z);
    var top1            = this.getTopOrBottomIndex(source_x, source_y, z, -1);
    var top2            = this.getTopOrBottomIndex(x, y, z, -1);
    var waterfall       = this.isWaterfall(this.autotileType(x, y, z));
    
    return (is_different || top1 > top2) && !is_top && !waterfall;
};

Game_Map.prototype.getTopOrBottomIndex = function(x, y, z, dir) {
    var start = this.autotileType(x, y, z);
    while (y >= 0 && y < $dataMap.height && this.autotileType(x, y, z) == start) {
        y += dir;
    }
    return y;
};

Game_Map.prototype.getAutotileTileId = function(autotile, index) {
    return 2048 + (48 * autotile) + index;
};

Game_Map.prototype.isWater = function(autotile) {
    return [0, 1, 4, 6, 8, 10, 12, 14].contains(autotile);
};

Game_Map.prototype.isWaterAddition = function(autotile) {
    return [2, 3].contains(autotile);
};

Game_Map.prototype.isWaterfall = function(autotile) {
    return [5, 7, 9, 11, 13, 15].contains(autotile);
};

Game_Map.prototype.isFloor = function(autotile) {
    return this.MK_inTilesetLines(autotile, [2, 3, 4, 5]);
};

Game_Map.prototype.isBuildingTop = function(autotile) {
    return this.MK_inTilesetLines(autotile, [6, 8]);
};

Game_Map.prototype.isBuildingWall = function(autotile) {
    return this.MK_inTilesetLines(autotile, [7, 9]);
};

Game_Map.prototype.isWallTop = function(autotile) {
    return this.MK_inTilesetLines(autotile, [10, 12, 14]);
};

Game_Map.prototype.isWall = function(autotile) {
    return this.MK_inTilesetLines(autotile, [11, 13, 15]);
};

Game_Map.prototype.MK_inTilesetLines = function(autotile, lines) {
    return lines.filter(line => this.MK_inTilesetLine(autotile, line)).length > 0;
};

Game_Map.prototype.MK_inTilesetLine = function(autotile, line) {
    return line * 8 <= autotile && autotile < (line + 1) * 8;
};

/*
 * Returns index by given 'left' and 'right'
 */
Game_Map.prototype.waterfallAutotileIndex = function(l, r) {
    var edge = 0;
    if(l)   edge += 1;
    if(r)   edge += 2;
    return edge;
};

/*
 * Returns index by given 4 direction input
 */
Game_Map.prototype.wallTopAutotileIndex = function(u, d, l, r) {
    var edge = 0;
    if(l)   edge += 1;
    if(u)   edge += 2;
    if(r)   edge += 4;
    if(d)   edge += 8;
    return edge;
};

/*
 * Returns index by given 8 direction input
 */
Game_Map.prototype.normalAutotileIndex = function(u, d, l, r, ul, ur, dl, dr) {
    
    var edge = 0;
    
    if(l)   edge += 1;
    if(u)   edge += 2;
    if(r)   edge += 4;
    if(d)   edge += 8;
    
    var corner = 0;
    switch(edge) {
        case 0:
            if(ul)  corner += 1;
            if(ur)  corner += 2;
            if(dr)  corner += 4;
            if(dl)  corner += 8;
            return  corner;
        
        case 1:
            if(ur)  corner += 1;
            if(dr)  corner += 2;
            return  16 + corner;
        
        case 2:
            if(dr)  corner += 1;
            if(dl)  corner += 2;
            return  20 + corner;
       
        case 4:
            if(dl)  corner += 1;
            if(ul)  corner += 2;
            return  24 + corner;
        
        case 8:
            if(ul)  corner += 1;
            if(ur)  corner += 2;
            return  28 + corner;
        
        case 5:     return 32;
        case 10:    return 33;
        case 3:     return dr ? 35 : 34;
        case 6:     return dl ? 37 : 36;
        case 12:    return ul ? 39 : 38;
        case 9:     return ur ? 41 : 40;
        case 7 :    return 42;
        case 11:    return 43;
        case 13:    return 44;
        case 14:    return 45;
        case 15:    return 46;
        default:    return 47;
    }
};

Game_Map.prototype.getAutotileGroup = function(autotile) {
    if (this.isWater(autotile))         return 'water';
    if (this.isWaterAddition(autotile)) return 'waterAddition';
    if (this.isWaterfall(autotile))     return 'waterfall';
    if (this.isFloor(autotile))         return 'floor';
    if (this.isBuildingTop(autotile))   return 'buildingTop';
    if (this.isBuildingWall(autotile))  return 'buildingWall';
    if (this.isWallTop(autotile))       return 'wallTop';
    if (this.isWall(autotile))          return 'wall';
    return 'default';
};

Game_Map.prototype.updateAutotile = function(x, y, z) {
    var autotile = this.autotileType(x, y, z);
    
    if(autotile < 0) {
        return;
    }
    
    var index = 0;
    var autoTileGroup = this.getAutotileGroup(autotile);
    
    switch(autoTileGroup) {
        
        case 'water':
        case 'waterAddition':
        case 'floor':
        case 'wallTop':
            var  l = this.autotileEdge(autotile, x - 1, y, z);
            var  r = this.autotileEdge(autotile, x + 1, y, z);
            var  u = this.autotileEdge(autotile, x, y - 1, z);
            var  d = this.autotileEdge(autotile, x, y + 1, z);
            var ul = this.autotileEdge(autotile, x - 1, y - 1, z);
            var ur = this.autotileEdge(autotile, x + 1, y - 1, z);
            var dl = this.autotileEdge(autotile, x - 1, y + 1, z);
            var dr = this.autotileEdge(autotile, x + 1, y + 1, z);
            
            if (autoTileGroup == 'water') {
                var water_ul        = this.isWater(this.autotileType(x - 1, y - 1, z));
                var water_ur        = this.isWater(this.autotileType(x + 1, y - 1, z));
                var waterfall_ul    = this.isWaterfall(this.autotileType(x - 1, y - 1, z));
                var waterfall_u     = this.isWaterfall(this.autotileType(x, y - 1, z));
                var waterfall_ur    = this.isWaterfall(this.autotileType(x + 1, y - 1, z));
                
                if (waterfall_u)                    u  = false;
                if (waterfall_u && waterfall_ul)    ul = false;
                if (waterfall_u && waterfall_ur)    ur = false;
                
                if (waterfall_u && water_ul)        ul = true;
                if (waterfall_u && water_ur)        ur = true;
            }
            
            var top_dl = this.isWallTop(this.autotileType(x - 1, y + 1, z))
                || this.isBuildingTop(this.autotileType(x - 1, y + 1, z));
            var top_d = this.isWallTop(this.autotileType(x, y + 1, z))
                || this.isBuildingTop(this.autotileType(x, y + 1, z));
            var top_dr = this.isWallTop(this.autotileType(x + 1, y + 1, z))
                || this.isBuildingTop(this.autotileType(x + 1, y + 1, z));
            var top_l = this.isWallTop(this.autotileType(x - 1, y, z))
                || this.isBuildingTop(this.autotileType(x - 1, y, z));
            var top_r = this.isWallTop(this.autotileType(x + 1, y, z))
                || this.isBuildingTop(this.autotileType(x + 1, y, z));
            
            if (top_d)          d  = false;
            if (top_dl && !l)   dl = false;
            if (top_dr && !r)   dr = false;
            if (top_l  && !ul)  l  = false;
            if (top_r  && !ur)  r  = false;

            // Compatibility
            if (MK.mv3d || MK.mz3d) {

                function height(x, y) {
                    let regionId = $gameMap.regionId(x, y);
                    let e = MK.mv3d
                        ? mv3d.REGION_DATA[regionId]
                        : mz3d.REGION_DATA[regionId];
                    return e ? e.height : 0;
                }

                u  = u  || height(x, y - 1) < height(x, y);
                l  = l  || height(x - 1, y) < height(x, y);
                r  = r  || height(x + 1, y) < height(x, y);
                d  = d  || height(x, y + 1) < height(x, y);
                ul = ul || height(x - 1, y - 1) < height(x, y);
                ur = ur || height(x + 1, y - 1) < height(x, y);
                dl = dl || height(x - 1, y + 1) < height(x, y);
                dr = dr || height(x + 1, y + 1) < height(x, y);
            }
            index = this.normalAutotileIndex(u, d, l, r, ul, ur, dl, dr);
            break;
        
        case 'waterfall':
            var l = this.autotileEdge(autotile, x - 1, y, z);
            var r = this.autotileEdge(autotile, x + 1, y, z);
            
            var waterfall_l = this.isWaterfall(this.autotileType(x - 1, y, z));
            var waterfall_r = this.isWaterfall(this.autotileType(x + 1, y, z));
            var top   = this.getTopOrBottomIndex(x, y, z, -1);
            var top_l = this.getTopOrBottomIndex(x - 1, y, z, -1);
            var top_r = this.getTopOrBottomIndex(x + 1, y, z, -1);
            
            if (waterfall_l && top != top_l)    l = true;
            if (waterfall_r && top != top_r)    r = true;
            
            index = this.waterfallAutotileIndex(l, r);
            break;
        
        case 'buildingTop':
        case 'buildingWall':
        case 'wall':
            var l = this.autotileWallEdge(autotile, x, y, x - 1, y, z);
            var r = this.autotileWallEdge(autotile, x, y, x + 1, y, z);
            var u = this.autotileEdge(autotile, x, y - 1, z);
            var d = this.autotileEdge(autotile, x, y + 1, z);
            
            index = this.wallTopAutotileIndex(u, d, l, r);
            break;
    }
    
    $dataMap.data[this.tileIndex(x, y, z)] = this.getAutotileTileId(autotile, index);
};

Game_Map.prototype.updateAllAutoTiles = function() {
    for(var i = 0; i < this.width(); i++) {
        for(var j = 0; j < this.height(); j++) {
            for(var k = 0; k < 6; k++) {
                this.updateAutotile(i, j, k);
            }
        }
    }
};

var _0x391e=['wipeCurrentMap','1JbPqqo','random','pick_random','requireNonNull','validateMapSettingsMaze','snippetsarea','Snippets\x20Map','requireToBeOneOfThese','assetsInfo','You\x20wanted\x20to\x20draw\x20a\x20Decoration\x20with\x20Region\x20Id\x20','bottom','cutOffDeadEnds','every','top','997Zqbmsf','getPossibleLocations','getSnippetHeight','dataMap','allowLargeAreas','mathRandomMinMax','Map\x20[','_generated','drawAsset','randomWalk','binary2drawable','findIndex','length','drawDecorationXTimes','getPossibleLocationsByDirection','any','1NBgMEL','_borderWidth','params','width','contains','setValue','_generateOuterMaps','mazeAlgorithms','tile','makeWayOut','resetAfterFinalize','finalize','Areas\x20Map','allowRevisit','snippets','drawDecorations','This\x20could\x20be\x20caused\x20by\x203rd\x20Party\x20Plugins\x20that\x20also\x20have\x20Event\x20Clone\x20Systems.','ENTRANCE_REGION_ID','cloneEventsFromArea','map','_allowLargeAreas','setTileStack','generate','leaveRNGArea','_allowRevisit','safelyCopyTiles','pop','noSeedableRNG','events','injectDataMap','forEach','RandomWalk:\x20Cannot\x20start\x20and\x20end\x20from\x20same\x20direction','Please\x20check\x20if\x20it\x20is\x20defined,\x20in\x20Map\x20Tree\x20below\x20Space\x20Map,\x20and\x20has\x20the\x20name\x20\x27','mapId','additionalMaps','845483JfRTgt','index','_allowGoingBack','left','placeEntranceOn','prims','height','createMatrix','FATAL:\x20get\x20Possible\x20Locations:\x20No\x20region\x20Id\x20given!','1faQDhC','eraseShadows','getDungeonHeight','592348hXrGtN','number','onUsePremiumFunctionAlert','372107JtAHfr','copyTileFromXY','reset','cloneEvent','direction\x20must\x20be\x20either\x20bottom,\x20top,\x20left,\x20right\x20or\x20any,\x20but\x20was\x20','_remapSnippets','eraseRegionIdsAndShadows','getSnippetWidth','safelyPasteTileStack','exit','arrange','filter','rng','placeExitOn','_start','SPAWNING_POINT_REGION_ID','_exit','end','decoration','172829nfUPkR','threshold','\x20but\x20the\x20dataMap\x20has\x20already\x20stored\x20this\x20id.\x0a','DECORATION_STOPPER_ID','validateSpaceMap','_choseSpecialLocation','spawnPlayerAt','541237JILHAF','down','error','_remapSnippet','right','run_randomWalk','isTileEmpty','validateMapSettingsWithArea','1Vmamfq','snippetsArea','randomInteger','buildTunnel','start','push','Decoration\x20Map\x20not\x20defined','data','borderWidth','eraseRegionIds','EXIT_REGION_ID','getDungeonWidth','spawnLocation','124BYOApZ','eraseRegionId','_identifyDecoRegions','setSeed','Your\x20Space\x20Map\x20is\x20too\x20small.\x20Minimum\x20Dimension\x20is\x20','1HPnUNJ','snippetstransitions','getTileStack','Transitions\x20Map','mergeDeadEnds','231732LPWuug','isAreaEmpty','regionId','isAnyEventInThisArea','DEFAULT_BORDER_WIDTH','There\x27s\x20no\x20Snippets\x20Map\x20defined\x20to\x20generate\x20dungeon.\x20Please\x20insert\x20at\x20least\x20one\x20snippets\x20map\x20in\x20Space\x20Map\x27s\x20note\x20tags.','cloneEventFromXY','floor','snippetsouter','getNextEventId','\x20not\x20found!\x0a','drawDecorationToXY','refreshSelfSwitchesForEvent','placeSnippet','makeDeepCopy'];var _0xf90017=_0x5f4c;(function(_0x1de24c,_0x472b57){var _0x273103=_0x5f4c;while(!![]){try{var _0x45f0d8=parseInt(_0x273103(0x21f))*-parseInt(_0x273103(0x20f))+-parseInt(_0x273103(0x1d3))+parseInt(_0x273103(0x1e9))*parseInt(_0x273103(0x23d))+parseInt(_0x273103(0x260))*parseInt(_0x273103(0x20a))+-parseInt(_0x273103(0x1f8))*-parseInt(_0x273103(0x1f0))+parseInt(_0x273103(0x22d))*parseInt(_0x273103(0x205))+-parseInt(_0x273103(0x1d6))*parseInt(_0x273103(0x269));if(_0x45f0d8===_0x472b57)break;else _0x1de24c['push'](_0x1de24c['shift']());}catch(_0x5993e2){_0x1de24c['push'](_0x1de24c['shift']());}}}(_0x391e,0x76e4e),MK[_0xf90017(0x1e2)]={},MK['rng'][_0xf90017(0x1fa)]=function(_0x47ad0e,_0x44b481){var _0x486c6c=_0xf90017;const _0x28f8e9=_0x44b481?_0x47ad0e:0x0,_0x26b766=_0x44b481?_0x44b481:_0x47ad0e;return _0x28f8e9==_0x26b766?_0x28f8e9:this[_0x486c6c(0x232)](_0x28f8e9,_0x26b766);},MK[_0xf90017(0x1e2)][_0xf90017(0x232)]=function(_0x2f07a2,_0x5ef691){var _0x8f5d8c=_0xf90017;return Math[_0x8f5d8c(0x216)](Math[_0x8f5d8c(0x220)]()*(_0x5ef691-_0x2f07a2+0x1))+_0x2f07a2;},MK[_0xf90017(0x1e2)][_0xf90017(0x1ea)]=function(_0x42aa3b){var _0x48e232=_0xf90017;return _0x42aa3b==0x1?!![]:_0x42aa3b*0x64>=this[_0x48e232(0x1fa)](0x1,0x64);},MK[_0xf90017(0x1e2)]['pick_random']=function(_0x89a5bf){var _0x48bfec=_0xf90017;return _0x89a5bf[_0x48bfec(0x239)]==0x1?_0x89a5bf[0x0]:_0x89a5bf[this[_0x48bfec(0x1fa)](_0x89a5bf[_0x48bfec(0x239)]-0x1)];},MK[_0xf90017(0x1e2)][_0xf90017(0x208)]=function(){var _0x13b4f8=_0xf90017;MK[_0x13b4f8(0x1d5)](_0x13b4f8(0x208));},MK[_0xf90017(0x1e2)]['noSeedableRNG']=function(){var _0x333000=_0xf90017;MK['onUsePremiumFunctionAlert'](_0x333000(0x258));},MK['mazeAlgorithms']={},MK['mazeAlgorithms'][_0xf90017(0x265)]=function(_0xe92acd,_0x2b86b7){var _0x306090=_0xf90017;MK[_0x306090(0x222)](_0xe92acd,'prims','w'),MK[_0x306090(0x222)](_0x2b86b7,_0x306090(0x265),'h');const _0x118077=MK[_0x306090(0x267)](_0xe92acd,_0x2b86b7),_0x5136a3=[];for(let _0xd8f810=0x0;_0xd8f810<_0xe92acd;_0xd8f810++){for(let _0x47e68a=0x0;_0x47e68a<_0x2b86b7;_0x47e68a++){_0x5136a3[_0x306090(0x1fd)]({'x':_0xd8f810,'y':_0x47e68a});}}_0x118077[0x1][0x0]=_0x118077[0x1][0x0]|0x4,_0x118077[0x1][0x1]=_0x118077[0x1][0x1]|0x1;let _0xe78c81=_0xe92acd*_0x2b86b7;while(_0xe78c81>0x0){_0xe78c81-=0x1;let _0x28b14b=[];for(let _0x5c574d=0x0;_0x5c574d<_0x5136a3[_0x306090(0x239)];_0x5c574d++){let _0x31fb86=_0x5136a3[_0x5c574d];if(_0x118077[_0x31fb86['x']][_0x31fb86['y']]==0x0&&_0x31fb86['x']!=0x0&&_0x118077[_0x31fb86['x']-0x1][_0x31fb86['y']]!=0x0)_0x28b14b['push'](_0x31fb86);if(_0x118077[_0x31fb86['x']][_0x31fb86['y']]==0x0&&_0x31fb86['x']<_0xe92acd-0x1&&_0x118077[_0x31fb86['x']+0x1][_0x31fb86['y']]!=0x0)_0x28b14b[_0x306090(0x1fd)](_0x31fb86);if(_0x118077[_0x31fb86['x']][_0x31fb86['y']]==0x0&&_0x31fb86['y']!=0x0&&_0x118077[_0x31fb86['x']][_0x31fb86['y']-0x1]!=0x0)_0x28b14b[_0x306090(0x1fd)](_0x31fb86);if(_0x118077[_0x31fb86['x']][_0x31fb86['y']]==0x0&&_0x31fb86['y']<_0x2b86b7-0x1&&_0x118077[_0x31fb86['x']][_0x31fb86['y']+0x1]!=0x0)_0x28b14b[_0x306090(0x1fd)](_0x31fb86);}if(_0x28b14b[_0x306090(0x239)]==0x0)break;let _0x5acb35=MK[_0x306090(0x1e2)]['pick_random'](_0x28b14b),_0x53d017=[];if(_0x5acb35['x']>0x0&&_0x118077[_0x5acb35['x']-0x1][_0x5acb35['y']]!=0x0)_0x53d017['push'](_0x306090(0x263));if(_0x5acb35['x']<_0xe92acd-0x1&&_0x118077[_0x5acb35['x']+0x1][_0x5acb35['y']]!=0x0)_0x53d017['push'](_0x306090(0x1f4));if(_0x5acb35['y']>0x0&&_0x118077[_0x5acb35['x']][_0x5acb35['y']-0x1]!=0x0)_0x53d017[_0x306090(0x1fd)]('up');if(_0x5acb35['y']<_0x2b86b7-0x1&&_0x118077[_0x5acb35['x']][_0x5acb35['y']+0x1]!=0x0)_0x53d017['push'](_0x306090(0x1f1));let _0x47675a=MK[_0x306090(0x1e2)][_0x306090(0x221)](_0x53d017);_0x47675a=='left'&&(_0x118077[_0x5acb35['x']][_0x5acb35['y']]=_0x118077[_0x5acb35['x']][_0x5acb35['y']]|0x8,_0x118077[_0x5acb35['x']-0x1][_0x5acb35['y']]=_0x118077[_0x5acb35['x']-0x1][_0x5acb35['y']]|0x2),_0x47675a=='right'&&(_0x118077[_0x5acb35['x']][_0x5acb35['y']]=_0x118077[_0x5acb35['x']][_0x5acb35['y']]|0x2,_0x118077[_0x5acb35['x']+0x1][_0x5acb35['y']]=_0x118077[_0x5acb35['x']+0x1][_0x5acb35['y']]|0x8),_0x47675a=='up'&&(_0x118077[_0x5acb35['x']][_0x5acb35['y']]=_0x118077[_0x5acb35['x']][_0x5acb35['y']]|0x1,_0x118077[_0x5acb35['x']][_0x5acb35['y']-0x1]=_0x118077[_0x5acb35['x']][_0x5acb35['y']-0x1]|0x4),_0x47675a==_0x306090(0x1f1)&&(_0x118077[_0x5acb35['x']][_0x5acb35['y']]=_0x118077[_0x5acb35['x']][_0x5acb35['y']]|0x4,_0x118077[_0x5acb35['x']][_0x5acb35['y']+0x1]=_0x118077[_0x5acb35['x']][_0x5acb35['y']+0x1]|0x1);}return _0x118077;},MK['mazeAlgorithms'][_0xf90017(0x236)]=function(_0x486090,_0x2499af,_0x2c7021){var _0x1b70d1=_0xf90017;MK[_0x1b70d1(0x222)](_0x486090,_0x1b70d1(0x236),'w'),MK[_0x1b70d1(0x222)](_0x2499af,_0x1b70d1(0x236),'h'),MK[_0x1b70d1(0x222)](_0x2c7021,_0x1b70d1(0x236),_0x1b70d1(0x23f));const _0x421833=_0x2c7021[_0x1b70d1(0x1e4)]||_0x1b70d1(0x229),_0x1ad6c6=_0x2c7021[_0x1b70d1(0x1e6)]||_0x1b70d1(0x22c);MK[_0x1b70d1(0x226)](_0x421833,['top',_0x1b70d1(0x1f4),_0x1b70d1(0x263),'bottom'],_0x1b70d1(0x236),'start'),MK[_0x1b70d1(0x226)](_0x1ad6c6,[_0x1b70d1(0x22c),'right','left','bottom'],'randomWalk',_0x1b70d1(0x1e7));if(_0x421833==_0x1ad6c6)throw Error(_0x1b70d1(0x25c));let _0x1b82b6=_0x2c7021[_0x1b70d1(0x262)]||_0x421833!='top',_0xd9224d=_0x2c7021['_allowGoingBack']||_0x421833!='right',_0x49492c=_0x2c7021[_0x1b70d1(0x262)]||_0x421833!=_0x1b70d1(0x263),_0x3c2a23=_0x2c7021[_0x1b70d1(0x262)]||_0x421833!=_0x1b70d1(0x229);const _0x24c391=MK[_0x1b70d1(0x267)](_0x486090,_0x2499af,0x0),_0x3e6dd8=MK[_0x1b70d1(0x267)](_0x486090,_0x2499af,![]);let _0x214538,_0x494a22;_0x421833==_0x1b70d1(0x22c)&&(_0x214538=Math[_0x1b70d1(0x216)](_0x486090/0x2),_0x494a22=0x0);_0x421833==_0x1b70d1(0x1f4)&&(_0x214538=_0x486090-0x1,_0x494a22=Math[_0x1b70d1(0x216)](_0x2499af/0x2));_0x421833==_0x1b70d1(0x263)&&(_0x214538=0x0,_0x494a22=Math['floor'](_0x2499af/0x2));_0x421833==_0x1b70d1(0x229)&&(_0x214538=Math['floor'](_0x486090/0x2),_0x494a22=_0x2499af-0x1);_0x24c391[_0x214538][_0x494a22]=0x1;var _0x307d33=_0x214538,_0xe0c366=_0x494a22,_0x5b56f5=[];_0x5b56f5[_0x1b70d1(0x1fd)]({'x':_0x307d33,'y':_0xe0c366});while(_0x5b56f5['length']>0x0){_0x307d33=_0x5b56f5[_0x5b56f5[_0x1b70d1(0x239)]-0x1]['x'],_0xe0c366=_0x5b56f5[_0x5b56f5[_0x1b70d1(0x239)]-0x1]['y'],_0x24c391[_0x307d33][_0xe0c366]=0x1,_0x3e6dd8[_0x307d33][_0xe0c366]=!![];var _0x17354c=[];if(_0x1ad6c6=='top'&&_0xe0c366==0x0)break;if(_0x1ad6c6==_0x1b70d1(0x1f4)&&_0x307d33==_0x486090-0x1)break;if(_0x1ad6c6=='left'&&_0x307d33==0x0)break;if(_0x1ad6c6==_0x1b70d1(0x229)&&_0xe0c366==_0x2499af-0x1)break;function _0x4470a3(_0x2b7a6b,_0xa4c9aa){return 0x0<=_0x2b7a6b&&_0x2b7a6b<_0x486090&&0x0<=_0xa4c9aa&&_0xa4c9aa<_0x2499af;}function _0x4e82d7(_0x29b09e,_0x2d73d3){var _0x53e3b0=_0x1b70d1;return _0x4470a3(_0x29b09e,_0x2d73d3)&&(_0x2c7021[_0x53e3b0(0x255)]||!_0x24c391[_0x29b09e][_0x2d73d3]&&!_0x3e6dd8[_0x29b09e][_0x2d73d3]);}function _0x45092a(_0x9ffa48,_0x34908c){var _0xc4def6=_0x1b70d1;if(!_0x4470a3(_0x9ffa48,_0x34908c))return![];if(!_0x2c7021[_0xc4def6(0x255)]&&_0x3e6dd8[_0x9ffa48][_0x34908c])return![];let _0x5d010e=0x0;if(_0x4470a3(_0x9ffa48,_0x34908c-0x1)&&_0x24c391[_0x9ffa48][_0x34908c-0x1])_0x5d010e++;if(_0x4470a3(_0x9ffa48,_0x34908c+0x1)&&_0x24c391[_0x9ffa48][_0x34908c+0x1])_0x5d010e++;if(_0x4470a3(_0x9ffa48-0x1,_0x34908c)&&_0x24c391[_0x9ffa48-0x1][_0x34908c])_0x5d010e++;if(_0x4470a3(_0x9ffa48+0x1,_0x34908c)&&_0x24c391[_0x9ffa48+0x1][_0x34908c])_0x5d010e++;return _0x5d010e<=0x1;}if(_0x2c7021[_0x1b70d1(0x251)]){if(_0x4e82d7(_0x307d33,_0xe0c366-0x1)&&_0x1b82b6)_0x17354c[_0x1b70d1(0x1fd)]('up');if(_0x4e82d7(_0x307d33+0x1,_0xe0c366)&&_0xd9224d)_0x17354c['push'](_0x1b70d1(0x1f4));if(_0x4e82d7(_0x307d33-0x1,_0xe0c366)&&_0x49492c)_0x17354c[_0x1b70d1(0x1fd)](_0x1b70d1(0x263));if(_0x4e82d7(_0x307d33,_0xe0c366+0x1)&&_0x3c2a23)_0x17354c[_0x1b70d1(0x1fd)](_0x1b70d1(0x1f1));}else{if(_0x45092a(_0x307d33,_0xe0c366-0x1)&&_0x1b82b6)_0x17354c['push']('up');if(_0x45092a(_0x307d33+0x1,_0xe0c366)&&_0xd9224d)_0x17354c[_0x1b70d1(0x1fd)](_0x1b70d1(0x1f4));if(_0x45092a(_0x307d33-0x1,_0xe0c366)&&_0x49492c)_0x17354c[_0x1b70d1(0x1fd)](_0x1b70d1(0x263));if(_0x45092a(_0x307d33,_0xe0c366+0x1)&&_0x3c2a23)_0x17354c['push']('down');}if(_0x17354c['length']==0x0){_0x5b56f5[_0x1b70d1(0x257)](),_0x24c391[_0x307d33][_0xe0c366]=0x0;continue;}const _0x356d4d=MK['rng'][_0x1b70d1(0x221)](_0x17354c);if(_0x356d4d=='up')_0xe0c366=_0xe0c366-0x1;if(_0x356d4d==_0x1b70d1(0x1f4))_0x307d33=_0x307d33+0x1;if(_0x356d4d==_0x1b70d1(0x263))_0x307d33=_0x307d33-0x1;if(_0x356d4d=='down')_0xe0c366=_0xe0c366+0x1;_0x5b56f5[_0x1b70d1(0x1fd)]({'x':_0x307d33,'y':_0xe0c366});}return this[_0x1b70d1(0x237)](_0x24c391);},MK[_0xf90017(0x244)]['binary2drawable']=function(_0x20835e){var _0x5309d6=_0xf90017;const _0x37cda4=_0x20835e[_0x5309d6(0x239)],_0x5c6bc6=_0x20835e[0x0]['length'],_0x5d975c=MK['createMatrix'](_0x37cda4,_0x5c6bc6);function _0x4342c7(_0x8a7a29,_0xa1c1f5){return _0x8a7a29>=0x0&&_0x8a7a29<_0x37cda4&&_0xa1c1f5>=0x0&&_0xa1c1f5<_0x5c6bc6&&_0x20835e[_0x8a7a29][_0xa1c1f5];}function _0x3784c8(_0x448732,_0x5ec0f2){return _0x4342c7(_0x448732-0x1,_0x5ec0f2)&&_0x4342c7(_0x448732-0x1,_0x5ec0f2-0x1)&&_0x4342c7(_0x448732,_0x5ec0f2-0x1)||_0x4342c7(_0x448732,_0x5ec0f2-0x1)&&_0x4342c7(_0x448732+0x1,_0x5ec0f2-0x1)&&_0x4342c7(_0x448732+0x1,_0x5ec0f2)||_0x4342c7(_0x448732+0x1,_0x5ec0f2)&&_0x4342c7(_0x448732+0x1,_0x5ec0f2+0x1)&&_0x4342c7(_0x448732,_0x5ec0f2+0x1)||_0x4342c7(_0x448732,_0x5ec0f2+0x1)&&_0x4342c7(_0x448732-0x1,_0x5ec0f2+0x1)&&_0x4342c7(_0x448732-0x1,_0x5ec0f2);}for(let _0x2459c6=0x0;_0x2459c6<_0x37cda4;_0x2459c6++){for(let _0x42085b=0x0;_0x42085b<_0x5c6bc6;_0x42085b++){if(!_0x20835e[_0x2459c6][_0x42085b]){_0x5d975c[_0x2459c6][_0x42085b]=0x0;continue;}let _0x205dd9=0x0;if(!_0x3784c8(_0x2459c6,_0x42085b)){if(_0x4342c7(_0x2459c6,_0x42085b-0x1))_0x205dd9=_0x205dd9|0x1;if(_0x4342c7(_0x2459c6+0x1,_0x42085b))_0x205dd9=_0x205dd9|0x2;if(_0x4342c7(_0x2459c6,_0x42085b+0x1))_0x205dd9=_0x205dd9|0x4;if(_0x4342c7(_0x2459c6-0x1,_0x42085b))_0x205dd9=_0x205dd9|0x8;}else{if(_0x4342c7(_0x2459c6+0x1,_0x42085b)&&_0x4342c7(_0x2459c6+0x1,_0x42085b+0x1)&&_0x4342c7(_0x2459c6,_0x42085b+0x1))_0x205dd9=_0x205dd9|0x1;if(_0x4342c7(_0x2459c6-0x1,_0x42085b)&&_0x4342c7(_0x2459c6-0x1,_0x42085b+0x1)&&_0x4342c7(_0x2459c6,_0x42085b+0x1))_0x205dd9=_0x205dd9|0x2;if(_0x4342c7(_0x2459c6-0x1,_0x42085b)&&_0x4342c7(_0x2459c6-0x1,_0x42085b-0x1)&&_0x4342c7(_0x2459c6,_0x42085b-0x1))_0x205dd9=_0x205dd9|0x4;if(_0x4342c7(_0x2459c6,_0x42085b-0x1)&&_0x4342c7(_0x2459c6+0x1,_0x42085b-0x1)&&_0x4342c7(_0x2459c6+0x1,_0x42085b))_0x205dd9=_0x205dd9|0x8;if(_0x205dd9==0x1)_0x205dd9=0x0;else{if(_0x205dd9==0x2)_0x205dd9=0x2;else{if(_0x205dd9==0x3)_0x205dd9=0x1;else{if(_0x205dd9==0x4)_0x205dd9=0x8;else{if(_0x205dd9==0x5)_0x205dd9=0xe;else{if(_0x205dd9==0x6)_0x205dd9=0x5;else{if(_0x205dd9==0x7)_0x205dd9=0xc;else{if(_0x205dd9==0x8)_0x205dd9=0x6;else{if(_0x205dd9==0x9)_0x205dd9=0x3;else{if(_0x205dd9==0xa)_0x205dd9=0xb;else{if(_0x205dd9==0xb)_0x205dd9=0xd;else{if(_0x205dd9==0xc)_0x205dd9=0x7;else{if(_0x205dd9==0xd)_0x205dd9=0xa;else{if(_0x205dd9==0xe)_0x205dd9=0x9;else{if(_0x205dd9==0xf)_0x205dd9=0x4;}}}}}}}}}}}}}}if(_0x205dd9==0x0&&_0x4342c7(_0x2459c6,_0x42085b-0x1)&&_0x4342c7(_0x2459c6-0x1,_0x42085b))_0x205dd9=0x10+0x3;else{if(_0x205dd9==0x2&&_0x4342c7(_0x2459c6,_0x42085b-0x1)&&_0x4342c7(_0x2459c6+0x1,_0x42085b))_0x205dd9=0x10+0x7;else{if(_0x205dd9==0x6&&_0x4342c7(_0x2459c6,_0x42085b+0x1)&&_0x4342c7(_0x2459c6-0x1,_0x42085b))_0x205dd9=0x10+0xf;else{if(_0x205dd9==0x8&&_0x4342c7(_0x2459c6,_0x42085b+0x1)&&_0x4342c7(_0x2459c6+0x1,_0x42085b))_0x205dd9=0x10+0xb;else{if(_0x205dd9==0x0&&_0x4342c7(_0x2459c6,_0x42085b-0x1))_0x205dd9=0x10+0x0;else{if(_0x205dd9==0x1&&_0x4342c7(_0x2459c6,_0x42085b-0x1))_0x205dd9=0x10+0x1;else{if(_0x205dd9==0x2&&_0x4342c7(_0x2459c6,_0x42085b-0x1))_0x205dd9=0x10+0x2;else{if(_0x205dd9==0x6&&_0x4342c7(_0x2459c6,_0x42085b+0x1))_0x205dd9=0x10+0x4;else{if(_0x205dd9==0x7&&_0x4342c7(_0x2459c6,_0x42085b+0x1))_0x205dd9=0x10+0x5;else{if(_0x205dd9==0x8&&_0x4342c7(_0x2459c6,_0x42085b+0x1))_0x205dd9=0x10+0x6;else{if(_0x205dd9==0x0&&_0x4342c7(_0x2459c6-0x1,_0x42085b))_0x205dd9=0x10+0x8;else{if(_0x205dd9==0x2&&_0x4342c7(_0x2459c6+0x1,_0x42085b))_0x205dd9=0x10+0x9;else{if(_0x205dd9==0x3&&_0x4342c7(_0x2459c6-0x1,_0x42085b))_0x205dd9=0x10+0xa;else{if(_0x205dd9==0x6&&_0x4342c7(_0x2459c6-0x1,_0x42085b))_0x205dd9=0x10+0xc;else{if(_0x205dd9==0x8&&_0x4342c7(_0x2459c6+0x1,_0x42085b))_0x205dd9=0x10+0xd;else{if(_0x205dd9==0x5&&_0x4342c7(_0x2459c6+0x1,_0x42085b))_0x205dd9=0x10+0xe;}}}}}}}}}}}}}}}_0x205dd9+=0x10;}_0x5d975c[_0x2459c6][_0x42085b]=_0x205dd9;}}return _0x5d975c;},MK[_0xf90017(0x244)][_0xf90017(0x246)]=function(_0x12b507,_0x39bf62){var _0x4df7b9=_0xf90017;MK[_0x4df7b9(0x222)](_0x12b507,_0x4df7b9(0x246),_0x4df7b9(0x250)),MK[_0x4df7b9(0x226)](_0x39bf62,['top',_0x4df7b9(0x263),'right',_0x4df7b9(0x229)],_0x4df7b9(0x246),'direction');const _0x3d200c=[],_0x59b501=_0x12b507[_0x4df7b9(0x239)],_0x306b78=_0x12b507[0x0]['length'];if(_0x39bf62==_0x4df7b9(0x229))for(let _0xc4c678=0x0;_0xc4c678<_0x59b501;_0xc4c678++){if(_0x12b507[_0xc4c678][_0x306b78-0x1]!=0x0)_0x3d200c['push']({'x':_0xc4c678,'y':_0x306b78-0x1});}if(_0x39bf62==_0x4df7b9(0x1f4))for(let _0x561b15=0x0;_0x561b15<_0x306b78;_0x561b15++){if(_0x12b507[_0x59b501-0x1][_0x561b15]!=0x0)_0x3d200c['push']({'x':_0x59b501-0x1,'y':_0x561b15});}if(_0x39bf62=='left')for(let _0x37784f=0x0;_0x37784f<_0x306b78;_0x37784f++){if(_0x12b507[0x0][_0x37784f]!=0x0)_0x3d200c[_0x4df7b9(0x1fd)]({'x':0x0,'y':_0x37784f});}if(_0x39bf62==_0x4df7b9(0x22c))for(let _0x2b441b=0x0;_0x2b441b<_0x59b501;_0x2b441b++){if(_0x12b507[_0x2b441b][0x0]!=0x0)_0x3d200c[_0x4df7b9(0x1fd)]({'x':_0x2b441b,'y':0x0});}if(_0x3d200c[_0x4df7b9(0x239)]>0x0){const _0xeaabcb=MK[_0x4df7b9(0x1e2)][_0x4df7b9(0x221)](_0x3d200c);MK[_0x4df7b9(0x244)][_0x4df7b9(0x1fb)](_0x12b507,_0xeaabcb['x'],_0xeaabcb['y'],_0x39bf62);}else MK[_0x4df7b9(0x244)]['connectMazeWithMapEnd'](_0x12b507,_0x39bf62);},MK[_0xf90017(0x244)]['connectMazeWithMapEnd']=function(_0x2d737b,_0x164d25){var _0x675d72=_0xf90017;let _0x2c6027,_0x260b7e,_0x33e089,_0x475aef,_0x1c9f81;const _0x562e7b=_0x2d737b[_0x675d72(0x239)],_0x1b6add=_0x2d737b[0x0][_0x675d72(0x239)];_0x164d25==_0x675d72(0x22c)&&(_0x2c6027=Math[_0x675d72(0x216)](_0x562e7b/0x2),_0x260b7e=0x0,_0x33e089=0x0,_0x475aef=0x1,_0x1c9f81=_0x675d72(0x229));_0x164d25==_0x675d72(0x263)&&(_0x2c6027=0x0,_0x260b7e=Math[_0x675d72(0x216)](_0x1b6add/0x2),_0x33e089=0x1,_0x475aef=0x0,_0x1c9f81=_0x675d72(0x1f4));_0x164d25=='right'&&(_0x2c6027=_0x562e7b-0x1,_0x260b7e=Math[_0x675d72(0x216)](_0x1b6add/0x2),_0x33e089=-0x1,_0x475aef=0x0,_0x1c9f81='left');_0x164d25==_0x675d72(0x229)&&(_0x2c6027=Math[_0x675d72(0x216)](_0x562e7b/0x2),_0x260b7e=_0x1b6add-0x1,_0x33e089=0x0,_0x475aef=-0x1,_0x1c9f81=_0x675d72(0x263));while(_0x2d737b[_0x2c6027][_0x260b7e]==0x0){MK[_0x675d72(0x244)]['buildTunnel'](_0x2d737b,_0x2c6027,_0x260b7e,_0x164d25),MK[_0x675d72(0x244)][_0x675d72(0x1fb)](_0x2d737b,_0x2c6027,_0x260b7e,_0x1c9f81),_0x2c6027=_0x2c6027+_0x33e089,_0x260b7e=_0x260b7e+_0x475aef;}MK[_0x675d72(0x244)]['buildTunnel'](_0x2d737b,_0x2c6027,_0x260b7e,_0x164d25);},MK[_0xf90017(0x244)][_0xf90017(0x1fb)]=function(_0x1bb624,_0x7edf11,_0xa2853b,_0x167d51){var _0x34b6ff=_0xf90017;const _0x191f97=_0x1bb624[_0x7edf11][_0xa2853b];let _0x4035ae;if(_0x167d51==_0x34b6ff(0x22c)&&_0x191f97<0x10)_0x4035ae=_0x191f97|0x1;if(_0x167d51==_0x34b6ff(0x1f4)&&_0x191f97<0x10)_0x4035ae=_0x191f97|0x2;if(_0x167d51=='bottom'&&_0x191f97<0x10)_0x4035ae=_0x191f97|0x4;if(_0x167d51==_0x34b6ff(0x263)&&_0x191f97<0x10)_0x4035ae=_0x191f97|0x8;if(_0x167d51==_0x34b6ff(0x22c)&&_0x191f97>=0x10){if(_0x191f97==0x10+0x0)_0x4035ae=0x20+0x0;if(_0x191f97==0x10+0x1)_0x4035ae=0x20+0x1;if(_0x191f97==0x10+0x2)_0x4035ae=0x20+0x2;if(_0x191f97==0x20+0x8)_0x4035ae=0x20+0x3;if(_0x191f97==0x20+0x9)_0x4035ae=0x20+0x8;}if(_0x167d51==_0x34b6ff(0x1f4)&&_0x191f97>=0x10){if(_0x191f97==0x10+0x2)_0x4035ae=0x20+0x9;if(_0x191f97==0x10+0x5)_0x4035ae=0x20+0xe;if(_0x191f97==0x10+0x8)_0x4035ae=0x20+0xd;if(_0x191f97==0x20+0x2)_0x4035ae=0x20+0x7;if(_0x191f97==0x20+0x6)_0x4035ae=0x20+0xb;}if(_0x167d51==_0x34b6ff(0x229)&&_0x191f97>=0x10){if(_0x191f97==0x10+0x6)_0x4035ae=0x20+0x4;if(_0x191f97==0x10+0x7)_0x4035ae=0x20+0x5;if(_0x191f97==0x10+0x8)_0x4035ae=0x20+0x6;if(_0x191f97==0x20+0xc)_0x4035ae=0x20+0xf;if(_0x191f97==0x20+0xd)_0x4035ae=0x20+0xb;}if(_0x167d51==_0x34b6ff(0x263)&&_0x191f97>=0x10){if(_0x191f97==0x10+0x0)_0x4035ae=0x20+0x8;if(_0x191f97==0x10+0x3)_0x4035ae=0x20+0xa;if(_0x191f97==0x10+0x6)_0x4035ae=0x20+0xc;if(_0x191f97==0x20+0x0)_0x4035ae=0x20+0x3;if(_0x191f97==0x20+0x4)_0x4035ae=0x20+0xf;}_0x1bb624[_0x7edf11][_0xa2853b]=_0x4035ae;});class DungeonGenerator{constructor(){var _0x394377=_0xf90017;this['_borderWidth']=MK[_0x394377(0x213)],this['spawnLocation']=null;}['reset'](){var _0x28ffe6=_0xf90017;this[_0x28ffe6(0x204)]=null,this[_0x28ffe6(0x230)]=MK['getMapFromDisk']($gameMap[_0x28ffe6(0x25e)]()),this[_0x28ffe6(0x25e)]=$gameMap[_0x28ffe6(0x25e)](),this[_0x28ffe6(0x227)]={};}[_0xf90017(0x247)](){var _0x183098=_0xf90017;this[_0x183098(0x23e)]=MK[_0x183098(0x213)];}[_0xf90017(0x254)](){var _0x478237=_0xf90017;this[_0x478237(0x230)]=null,this[_0x478237(0x25e)]=null;}[_0xf90017(0x208)](_0x81b36a){var _0x30e24b=_0xf90017;return MK[_0x30e24b(0x1e2)][_0x30e24b(0x208)](_0x81b36a),this;}[_0xf90017(0x258)](){var _0x2b8841=_0xf90017;return MK['rng'][_0x2b8841(0x258)](),this;}[_0xf90017(0x200)](_0x19524e){var _0x321a03=_0xf90017;return this[_0x321a03(0x23e)]=_0x19524e,this;}[_0xf90017(0x1dd)](){var _0xc9059c=_0xf90017;return Math[_0xc9059c(0x216)]((MK[_0xc9059c(0x25f)][_0xc9059c(0x24b)]['width']-0x5)/0x4);}['getSnippetHeight'](){var _0x447423=_0xf90017;return Math['floor']((MK[_0x447423(0x25f)][_0x447423(0x24b)]['height']-0x5)/0x4);}['getDungeonWidth'](){var _0x11fe51=_0xf90017;return Math[_0x11fe51(0x216)](($dataMap[_0x11fe51(0x240)]-0x2*this[_0x11fe51(0x23e)])/this['getSnippetWidth']());}[_0xf90017(0x26b)](){var _0x568cf5=_0xf90017;return Math[_0x568cf5(0x216)](($dataMap[_0x568cf5(0x266)]-0x2*this['_borderWidth'])/this['getSnippetHeight']());}['validateMapSettingsMaze'](){var _0x4d83d7=_0xf90017;if(!MK[_0x4d83d7(0x25f)][_0x4d83d7(0x24b)])this['error'](_0x4d83d7(0x225),_0x4d83d7(0x24b));this[_0x4d83d7(0x1ed)]();}[_0xf90017(0x1f7)](){var _0x2475d4=_0xf90017;if(!MK['additionalMaps'][_0x2475d4(0x24b)])this[_0x2475d4(0x1f2)]('Snippets\x20Map',_0x2475d4(0x24b));if(!MK[_0x2475d4(0x25f)][_0x2475d4(0x224)])this['error'](_0x2475d4(0x249),_0x2475d4(0x1f9));if(!MK[_0x2475d4(0x25f)][_0x2475d4(0x20b)])this[_0x2475d4(0x1f2)](_0x2475d4(0x20d),'snippetsTransitions');this[_0x2475d4(0x1ed)]();}[_0xf90017(0x1ed)](){var _0x3bf076=_0xf90017;const _0x4e49d5=this['getDungeonWidth'](),_0x163be4=this[_0x3bf076(0x26b)](),_0x2460ba=this[_0x3bf076(0x1dd)]()*0x3+0x2*this[_0x3bf076(0x23e)],_0x2b7bcb=this[_0x3bf076(0x22f)]()*0x3+0x2*this['_borderWidth'];if(_0x4e49d5<0x2||_0x163be4<0x2)throw Error(_0x3bf076(0x209)+_0x2460ba+'x'+_0x2b7bcb);}[_0xf90017(0x1f2)](_0x6e667e,_0x1dce0d){var _0x1f936d=_0xf90017;throw Error(_0x6e667e+_0x1f936d(0x219)+_0x1f936d(0x25d)+_0x1dce0d+'\x27');}[_0xf90017(0x261)](_0x53e323,_0x38928e,_0x3fc7aa,_0x1cc958){var _0x27c423=_0xf90017;_0x1cc958=_0x1cc958||this['dataMap'];const _0x105469=_0x1cc958['width'],_0x24bb2a=_0x1cc958[_0x27c423(0x266)];return _0x3fc7aa*_0x105469*_0x24bb2a+_0x38928e*_0x105469+_0x53e323;}[_0xf90017(0x245)](_0x2a8f62,_0x1f942c,_0x451c5c,_0x1653e7){var _0x2a1f2a=_0xf90017;_0x1653e7=_0x1653e7||this[_0x2a1f2a(0x230)];const _0x1e39ab=this[_0x2a1f2a(0x261)](_0x2a8f62,_0x1f942c,_0x451c5c,_0x1653e7);return _0x1653e7['data'][_0x1e39ab];}[_0xf90017(0x211)](_0x3665ef,_0x328cf8,_0x5eaf9a){var _0x2127ac=_0xf90017;return this[_0x2127ac(0x245)](_0x3665ef,_0x328cf8,0x5,_0x5eaf9a);}['isTileEmpty'](_0x206f2d,_0x151c1b,_0x57dbb5){var _0x1e773e=_0xf90017;return this['getTileStack'](_0x206f2d,_0x151c1b,_0x57dbb5)[_0x1e773e(0x22b)](_0x447461=>_0x447461==0x0);}[_0xf90017(0x20c)](_0x1fa692,_0x5f2c3e,_0x41cc24){var _0x520955=_0xf90017;return MK[_0x520955(0x1e0)](0x6)[_0x520955(0x250)](_0x7418ec=>this['tile'](_0x1fa692,_0x5f2c3e,_0x7418ec,_0x41cc24));}[_0xf90017(0x252)](_0x358330,_0x3a3546,_0x24dac,_0xbd406c){var _0x3cf5f1=_0xf90017;for(var _0x4983f9=0x0;_0x4983f9<0x6;_0x4983f9++){var _0x582c63=this[_0x3cf5f1(0x261)](_0x358330,_0x3a3546,_0x4983f9,_0x24dac);_0x24dac[_0x3cf5f1(0x1ff)][_0x582c63]=_0xbd406c[_0x4983f9];}}[_0xf90017(0x210)](_0x4c8f54,_0x130522,_0x15646b,_0x16239b,_0xf4a1d7){var _0x4141b1=_0xf90017;for(var _0x28d4f9=_0x4c8f54;_0x28d4f9<=_0x15646b;_0x28d4f9++){for(var _0x56a9dc=_0x130522;_0x56a9dc<=_0x16239b;_0x56a9dc++){if(!this[_0x4141b1(0x1f6)](_0x28d4f9,_0x56a9dc,_0xf4a1d7))return![];}}return!this[_0x4141b1(0x212)](_0x4c8f54,_0x130522,_0x15646b,_0x16239b,_0xf4a1d7);}[_0xf90017(0x212)](_0x44472e,_0x2945c5,_0x2999cd,_0x504c77,_0x30c5e5){var _0x5cd1c8=_0xf90017;return _0x30c5e5[_0x5cd1c8(0x259)]['filter'](_0x248552=>!!_0x248552)[_0x5cd1c8(0x1e1)](_0x4faac5=>_0x44472e<=_0x4faac5['x']&&_0x4faac5['x']<=_0x2999cd&&_0x2945c5<=_0x4faac5['y']&&_0x4faac5['y']<=_0x504c77)[_0x5cd1c8(0x239)]>0x0;}['placeSnippet'](_0x3c55f1,_0x4533c5,_0x43b7c7,_0x5273a3,_0x21a425,_0x16a488){var _0x16b4d0=_0xf90017;_0x21a425=_0x21a425?_0x21a425:0x4,_0x16a488=_0x16a488?_0x16a488:0x4;var _0x18c3a6=this['getSnippetWidth'](),_0x24d721=this[_0x16b4d0(0x22f)](),_0x1f93dc=_0x4533c5%_0x21a425,_0x258960=Math[_0x16b4d0(0x216)](_0x4533c5/_0x21a425),_0xfc5825=_0x43b7c7*_0x18c3a6+this[_0x16b4d0(0x23e)],_0x5dc059=_0x5273a3*_0x24d721+this[_0x16b4d0(0x23e)],_0x45e821=(_0x18c3a6+0x1)*_0x1f93dc+0x1,_0x3c4fc3=(_0x24d721+0x1)*_0x258960+0x1,_0x1d4477=(_0x18c3a6+0x1)*(_0x1f93dc+0x1)-0x1,_0x42bedb=(_0x24d721+0x1)*(_0x258960+0x1)-0x1;this[_0x16b4d0(0x256)](_0xfc5825,_0x5dc059,_0x3c55f1,_0x45e821,_0x3c4fc3,_0x1d4477,_0x42bedb),this['cloneEventsFromArea'](_0xfc5825,_0x5dc059,_0x3c55f1,_0x45e821,_0x3c4fc3,_0x1d4477,_0x42bedb);}['safelyCopyTiles'](_0x433d5,_0x272a7f,_0xd63a25,_0x2569f5,_0x1ae527,_0x5c4a4e,_0x1da274){var _0x3af6a4=_0xf90017;if(!MK[_0x3af6a4(0x25f)][_0xd63a25])throw Error(_0x3af6a4(0x233)+_0xd63a25+']\x20not\x20exists!\x20Please\x20define\x20it\x20and\x20put\x20it\x20as\x20Child\x20Map\x20of\x20the\x20Space\x20Map');const _0x2b68e1=_0x5c4a4e-_0x2569f5+0x1,_0x46e264=_0x1da274-_0x1ae527+0x1;for(let _0xbfd3c0=0x0;_0xbfd3c0<_0x2b68e1;_0xbfd3c0++){for(let _0x1eb562=0x0;_0x1eb562<_0x46e264;_0x1eb562++){this[_0x3af6a4(0x1d7)](_0x2569f5+_0xbfd3c0,_0x1ae527+_0x1eb562,_0x433d5+_0xbfd3c0,_0x272a7f+_0x1eb562,MK[_0x3af6a4(0x25f)][_0xd63a25],this[_0x3af6a4(0x230)]);}}}[_0xf90017(0x1d7)](_0x18d776,_0x535bfa,_0x570dc7,_0x5b7436,_0x47abfc,_0x16bb5e){var _0x5cdbc6=_0xf90017;const _0x484526=this[_0x5cdbc6(0x20c)](_0x18d776,_0x535bfa,_0x47abfc);this[_0x5cdbc6(0x1de)](_0x570dc7,_0x5b7436,_0x16bb5e,_0x484526);}['safelyPasteTileStack'](_0x1b5170,_0x311619,_0x3bcab2,_0x1663e9){var _0x2dd277=_0xf90017;const _0x3aa7d6=this['index'](_0x1b5170,_0x311619,0x0,_0x3bcab2),_0x4b6714=this[_0x2dd277(0x261)](_0x1b5170,_0x311619,0x1,_0x3bcab2),_0x36b4c0=this['index'](_0x1b5170,_0x311619,0x2,_0x3bcab2),_0x317fc0=this[_0x2dd277(0x261)](_0x1b5170,_0x311619,0x3,_0x3bcab2),_0x17cc15=this[_0x2dd277(0x261)](_0x1b5170,_0x311619,0x5,_0x3bcab2);_0x1663e9[0x0]&&(_0x3bcab2[_0x2dd277(0x1ff)][_0x3aa7d6]=_0x1663e9[0x0],_0x3bcab2[_0x2dd277(0x1ff)][_0x4b6714]=_0x1663e9[0x1]);_0x1663e9[0x1]&&(_0x3bcab2[_0x2dd277(0x1ff)][_0x4b6714]=_0x1663e9[0x1]);_0x1663e9[0x2]&&_0x1663e9[0x3]&&(_0x3bcab2[_0x2dd277(0x1ff)][_0x36b4c0]=_0x1663e9[0x2],_0x3bcab2[_0x2dd277(0x1ff)][_0x317fc0]=_0x1663e9[0x3]);if(_0x1663e9[0x2]&&!_0x1663e9[0x3]){if(_0x3bcab2[_0x2dd277(0x1ff)][_0x317fc0])_0x3bcab2[_0x2dd277(0x1ff)][_0x36b4c0]=_0x3bcab2[_0x2dd277(0x1ff)][_0x317fc0];_0x3bcab2[_0x2dd277(0x1ff)][_0x317fc0]=_0x1663e9[0x2];}if(!_0x1663e9[0x2]&&_0x1663e9[0x3]){if(_0x3bcab2['data'][_0x317fc0])_0x3bcab2[_0x2dd277(0x1ff)][_0x36b4c0]=_0x3bcab2[_0x2dd277(0x1ff)][_0x317fc0];_0x3bcab2[_0x2dd277(0x1ff)][_0x317fc0]=_0x1663e9[0x3];}_0x3bcab2[_0x2dd277(0x1ff)][_0x17cc15]=_0x1663e9[0x5];}[_0xf90017(0x206)](_0x20f735){var _0x2f9ad9=_0xf90017;for(var _0x1e3e94=0x0;_0x1e3e94<this[_0x2f9ad9(0x230)][_0x2f9ad9(0x240)];_0x1e3e94++){for(var _0xcf1667=0x0;_0xcf1667<this[_0x2f9ad9(0x230)][_0x2f9ad9(0x266)];_0xcf1667++){var _0x3a277f=this[_0x2f9ad9(0x261)](_0x1e3e94,_0xcf1667,0x5);this[_0x2f9ad9(0x230)][_0x2f9ad9(0x1ff)][_0x3a277f]==_0x20f735&&(this['dataMap'][_0x2f9ad9(0x1ff)][_0x3a277f]=0x0);}}return this;}[_0xf90017(0x201)](_0x153b87){return _0x153b87['forEach'](_0x36a98=>this['eraseRegionId'](_0x36a98)),this;}[_0xf90017(0x215)](_0x4d7fc7,_0x4a6cee,_0x45628c,_0x1c6cb3,_0x5f3564){var _0x5bd4ea=_0xf90017;const _0x3381b9=MK['additionalMaps'][_0x45628c]['events'][_0x5bd4ea(0x1e1)](_0x663da5=>_0x663da5&&_0x663da5['x']==_0x1c6cb3&&_0x663da5['y']==_0x5f3564),_0x5f5c5c=_0x3381b9[0x0];if(_0x5f5c5c)this[_0x5bd4ea(0x1d9)](_0x4d7fc7,_0x4a6cee,_0x5f5c5c);}[_0xf90017(0x1d9)](_0x126ff5,_0x7c197,_0x414e03){var _0x3346ff=_0xf90017;const _0x4e80b6=this[_0x3346ff(0x218)]();if(this['dataMap'][_0x3346ff(0x259)][_0x4e80b6])throw Error('FATAL:\x20Wanted\x20to\x20clone\x20Event\x20with\x20new\x20Id\x20'+_0x4e80b6+_0x3346ff(0x1eb)+_0x3346ff(0x24d));const _0x2f0afa=JsonEx[_0x3346ff(0x21d)](_0x414e03);_0x2f0afa['id']=_0x4e80b6,_0x2f0afa['x']=_0x126ff5,_0x2f0afa['y']=_0x7c197,this[_0x3346ff(0x230)]['events'][_0x4e80b6]=_0x2f0afa,this[_0x3346ff(0x21b)](_0x2f0afa['id']);}[_0xf90017(0x218)](){var _0x4a6c6e=_0xf90017;return this[_0x4a6c6e(0x230)]['events'][_0x4a6c6e(0x239)];}['refreshSelfSwitchesForEvent'](_0x170c6b){var _0x1b5be6=_0xf90017;$gameSelfSwitches['setValue']([$gameMap['mapId'](),_0x170c6b,'A'],![]),$gameSelfSwitches['setValue']([$gameMap[_0x1b5be6(0x25e)](),_0x170c6b,'B'],![]),$gameSelfSwitches[_0x1b5be6(0x242)]([$gameMap[_0x1b5be6(0x25e)](),_0x170c6b,'C'],![]),$gameSelfSwitches[_0x1b5be6(0x242)]([$gameMap[_0x1b5be6(0x25e)](),_0x170c6b,'D'],![]);}[_0xf90017(0x24f)](_0xca2e7,_0x144f39,_0x3163da,_0x16fe0d,_0x27d419,_0x2eafe1,_0x8340cd){for(var _0x4f81ef=0x0;_0x4f81ef<_0x2eafe1-_0x16fe0d+0x1;_0x4f81ef++){for(var _0x1b52d3=0x0;_0x1b52d3<_0x8340cd-_0x27d419+0x1;_0x1b52d3++){this['cloneEventFromXY'](_0xca2e7+_0x4f81ef,_0x144f39+_0x1b52d3,_0x3163da,_0x16fe0d+_0x4f81ef,_0x27d419+_0x1b52d3);}}}[_0xf90017(0x265)](){var _0x1450e5=_0xf90017;return this[_0x1450e5(0x1d8)](),this[_0x1450e5(0x223)](),this[_0x1450e5(0x250)]=MK[_0x1450e5(0x244)]['prims'](this[_0x1450e5(0x203)](),this[_0x1450e5(0x26b)]()),new MazeBuilderParams();}[_0xf90017(0x236)](){var _0x207278=_0xf90017;return this[_0x207278(0x1d8)](),new RandomWalkParams();}['run_randomWalk'](_0x6c7d04){var _0x454b2e=_0xf90017;this['validateMapSettingsWithArea']();const _0x7a405c=this[_0x454b2e(0x203)](),_0x5dec2c=this[_0x454b2e(0x26b)]();return this[_0x454b2e(0x250)]=MK['mazeAlgorithms'][_0x454b2e(0x236)](_0x7a405c,_0x5dec2c,_0x6c7d04),this;}['cutOffDeadEnds'](_0x24c55a,_0x477fd0){var _0x1f1de6=_0xf90017;_0x24c55a=_0x24c55a||0x1,_0x477fd0=_0x477fd0||this[_0x1f1de6(0x250)];for(let _0x37b6bc=0x0;_0x37b6bc<_0x24c55a;_0x37b6bc++){let _0x368687=[];for(let _0x32dbfa=0x0;_0x32dbfa<_0x477fd0[_0x1f1de6(0x239)];_0x32dbfa++){for(let _0x186cdb=0x0;_0x186cdb<_0x477fd0[_0x32dbfa]['length'];_0x186cdb++){if([0x1,0x2,0x4,0x8][_0x1f1de6(0x241)](_0x477fd0[_0x32dbfa][_0x186cdb]))_0x368687[_0x1f1de6(0x1fd)]({'x':_0x32dbfa,'y':_0x186cdb});}}for(let _0x41c339 of _0x368687){let _0x58aa64=_0x41c339['x'],_0x2a743f=_0x41c339['y'];_0x477fd0[_0x58aa64][_0x2a743f]==0x1&&(_0x477fd0[_0x58aa64][_0x2a743f]=0x0,_0x477fd0[_0x58aa64][_0x2a743f-0x1]=_0x477fd0[_0x58aa64][_0x2a743f-0x1]&0xb),_0x477fd0[_0x58aa64][_0x2a743f]==0x2&&(_0x477fd0[_0x58aa64][_0x2a743f]=0x0,_0x477fd0[_0x58aa64+0x1][_0x2a743f]=_0x477fd0[_0x58aa64+0x1][_0x2a743f]&0x7),_0x477fd0[_0x58aa64][_0x2a743f]==0x4&&(_0x477fd0[_0x58aa64][_0x2a743f]=0x0,_0x477fd0[_0x58aa64][_0x2a743f+0x1]=_0x477fd0[_0x58aa64][_0x2a743f+0x1]&0xe),_0x477fd0[_0x58aa64][_0x2a743f]==0x8&&(_0x477fd0[_0x58aa64][_0x2a743f]=0x0,_0x477fd0[_0x58aa64-0x1][_0x2a743f]=_0x477fd0[_0x58aa64-0x1][_0x2a743f]&0xd);}}}[_0xf90017(0x20e)](_0x4d1194,_0x901b6e){var _0x31360b=_0xf90017;_0x4d1194=_0x4d1194||0.5,_0x901b6e=_0x901b6e||this[_0x31360b(0x250)];for(let _0x4ae5a4=0x0;_0x4ae5a4<_0x901b6e[_0x31360b(0x239)];_0x4ae5a4++){for(let _0x10947b=0x0;_0x10947b<_0x901b6e[_0x4ae5a4][_0x31360b(0x239)];_0x10947b++){if([0x1,0x2,0x4,0x8][_0x31360b(0x241)](_0x901b6e[_0x4ae5a4][_0x10947b])){if(!MK[_0x31360b(0x1e2)][_0x31360b(0x1ea)](_0x4d1194))continue;let _0xfbfe11=[];if(_0x901b6e[_0x4ae5a4][_0x10947b]!=0x1&&_0x10947b>0x0&&_0x901b6e[_0x4ae5a4][_0x10947b-0x1]!=0x0)_0xfbfe11['push']('up');if(_0x901b6e[_0x4ae5a4][_0x10947b]!=0x2&&_0x4ae5a4<_0x901b6e[_0x31360b(0x239)]-0x1&&_0x901b6e[_0x4ae5a4+0x1][_0x10947b]!=0x0)_0xfbfe11[_0x31360b(0x1fd)](_0x31360b(0x1f4));if(_0x901b6e[_0x4ae5a4][_0x10947b]!=0x4&&_0x10947b<_0x901b6e[_0x4ae5a4]['length']-0x1&&_0x901b6e[_0x4ae5a4][_0x10947b+0x1]!=0x0)_0xfbfe11[_0x31360b(0x1fd)](_0x31360b(0x1f1));if(_0x901b6e[_0x4ae5a4][_0x10947b]!=0x8&&_0x4ae5a4>0x0&&_0x901b6e[_0x4ae5a4-0x1][_0x10947b]!=0x0)_0xfbfe11[_0x31360b(0x1fd)](_0x31360b(0x263));if(_0xfbfe11[_0x31360b(0x239)]==0x0)continue;const _0x1588a9=MK[_0x31360b(0x1e2)][_0x31360b(0x221)](_0xfbfe11);_0x1588a9=='up'&&(_0x901b6e[_0x4ae5a4][_0x10947b]=_0x901b6e[_0x4ae5a4][_0x10947b]|0x1,_0x901b6e[_0x4ae5a4][_0x10947b-0x1]=_0x901b6e[_0x4ae5a4][_0x10947b-0x1]|0x4),_0x1588a9=='right'&&(_0x901b6e[_0x4ae5a4][_0x10947b]=_0x901b6e[_0x4ae5a4][_0x10947b]|0x2,_0x901b6e[_0x4ae5a4+0x1][_0x10947b]=_0x901b6e[_0x4ae5a4+0x1][_0x10947b]|0x8),_0x1588a9==_0x31360b(0x1f1)&&(_0x901b6e[_0x4ae5a4][_0x10947b]=_0x901b6e[_0x4ae5a4][_0x10947b]|0x4,_0x901b6e[_0x4ae5a4][_0x10947b+0x1]=_0x901b6e[_0x4ae5a4][_0x10947b+0x1]|0x1),_0x1588a9==_0x31360b(0x263)&&(_0x901b6e[_0x4ae5a4][_0x10947b]=_0x901b6e[_0x4ae5a4][_0x10947b]|0x8,_0x901b6e[_0x4ae5a4-0x1][_0x10947b]=_0x901b6e[_0x4ae5a4-0x1][_0x10947b]|0x2);}}}}[_0xf90017(0x243)](_0x46b4dc){var _0x2341f3=_0xf90017,_0x46c191=_0x46b4dc[_0x2341f3(0x239)],_0x24f24b=_0x46b4dc[0x0][_0x2341f3(0x239)],_0x4380fd=MK['createMatrix'](_0x46c191,_0x24f24b);function _0x1e5665(_0x3197ca,_0x13a58c){return _0x3197ca<0x0||_0x3197ca>=_0x46c191||_0x13a58c<0x0||_0x13a58c>=_0x24f24b||_0x46b4dc[_0x3197ca][_0x13a58c]==0x0;}for(var _0x43c010=0x0;_0x43c010<_0x46c191;_0x43c010++){for(var _0x30ef34=0x0;_0x30ef34<_0x24f24b;_0x30ef34++){if(_0x46b4dc[_0x43c010][_0x30ef34]){_0x4380fd[_0x43c010][_0x30ef34]=_0x46b4dc[_0x43c010][_0x30ef34];continue;}var _0x1be024=0x0,_0x2e1cd9=0x0;if(_0x1e5665(_0x43c010+0x1,_0x30ef34)&&_0x1e5665(_0x43c010+0x1,_0x30ef34+0x1)&&_0x1e5665(_0x43c010,_0x30ef34+0x1))_0x1be024=_0x1be024|0x1;if(_0x1e5665(_0x43c010-0x1,_0x30ef34)&&_0x1e5665(_0x43c010-0x1,_0x30ef34+0x1)&&_0x1e5665(_0x43c010,_0x30ef34+0x1))_0x1be024=_0x1be024|0x2;if(_0x1e5665(_0x43c010-0x1,_0x30ef34)&&_0x1e5665(_0x43c010-0x1,_0x30ef34-0x1)&&_0x1e5665(_0x43c010,_0x30ef34-0x1))_0x1be024=_0x1be024|0x4;if(_0x1e5665(_0x43c010,_0x30ef34-0x1)&&_0x1e5665(_0x43c010+0x1,_0x30ef34-0x1)&&_0x1e5665(_0x43c010+0x1,_0x30ef34))_0x1be024=_0x1be024|0x8;if(_0x1be024==0x0)_0x2e1cd9=-0x40;if(_0x1be024==0x1)_0x2e1cd9=0x0;if(_0x1be024==0x2)_0x2e1cd9=0x2;if(_0x1be024==0x3)_0x2e1cd9=0x1;if(_0x1be024==0x4)_0x2e1cd9=0x8;if(_0x1be024==0x5)_0x2e1cd9=0xe;if(_0x1be024==0x6)_0x2e1cd9=0x5;if(_0x1be024==0x7)_0x2e1cd9=0xc;if(_0x1be024==0x8)_0x2e1cd9=0x6;if(_0x1be024==0x9)_0x2e1cd9=0x3;if(_0x1be024==0xa)_0x2e1cd9=0xb;if(_0x1be024==0xb)_0x2e1cd9=0xd;if(_0x1be024==0xc)_0x2e1cd9=0x7;if(_0x1be024==0xd)_0x2e1cd9=0xa;if(_0x1be024==0xe)_0x2e1cd9=0x9;if(_0x1be024==0xf)_0x2e1cd9=0x4;_0x2e1cd9+=0x40,_0x4380fd[_0x43c010][_0x30ef34]=_0x2e1cd9;}}for(var _0x43c010=0x0;_0x43c010<_0x46c191;_0x43c010++){for(var _0x30ef34=0x0;_0x30ef34<_0x24f24b;_0x30ef34++){_0x46b4dc[_0x43c010][_0x30ef34]=_0x4380fd[_0x43c010][_0x30ef34];}}}['_remapSnippets'](_0x2d1737){var _0x494b6e=_0xf90017;for(let _0x37e932=0x0;_0x37e932<_0x2d1737[_0x494b6e(0x239)];_0x37e932++){for(let _0x2d1e20=0x0;_0x2d1e20<_0x2d1737[0x0][_0x494b6e(0x239)];_0x2d1e20++){_0x2d1737[_0x37e932][_0x2d1e20]=this[_0x494b6e(0x1f3)](_0x2d1737[_0x37e932][_0x2d1e20]);}}}['_remapSnippet'](_0xc92a72){switch(_0xc92a72){case 0x0:return 0x0;case 0x1:return 0xc;case 0x2:return 0xd;case 0x3:return 0x9;case 0x4:return 0xe;case 0x5:return 0x4;case 0x6:return 0x1;case 0x7:return 0x5;case 0x8:return 0xf;case 0x9:return 0xb;case 0xa:return 0x8;case 0xb:return 0xa;case 0xc:return 0x3;case 0xd:return 0x7;case 0xe:return 0x2;case 0xf:return 0x6;}return _0xc92a72;}[_0xf90017(0x21e)](){var _0x56d5a3=_0xf90017;MK[_0x56d5a3(0x1e0)](this[_0x56d5a3(0x230)]['length'])[_0x56d5a3(0x25b)](_0x1189d4=>this[_0x56d5a3(0x230)][_0x1189d4]=0x0);}['generate'](){var _0x47ba7c=_0xf90017;const _0x3fe45d=this[_0x47ba7c(0x250)];this[_0x47ba7c(0x1db)](this[_0x47ba7c(0x250)]),this[_0x47ba7c(0x21e)]();var _0x4fd09b='snippets'in MK[_0x47ba7c(0x25f)]?[_0x47ba7c(0x24b)]:[],_0x441a31='snippetsarea'in MK['additionalMaps']?[_0x47ba7c(0x224)]:[],_0x199b26=_0x47ba7c(0x20b)in MK[_0x47ba7c(0x25f)]?[_0x47ba7c(0x20b)]:[],_0x4a32e6='snippetsouter'in MK[_0x47ba7c(0x25f)]?[_0x47ba7c(0x217)]:[];for(let _0x1b2f66=0x0;_0x1b2f66<0x63;_0x1b2f66++){if(_0x47ba7c(0x24b)+_0x1b2f66 in MK[_0x47ba7c(0x25f)])_0x4fd09b[_0x47ba7c(0x1fd)]('snippets'+_0x1b2f66);if(_0x47ba7c(0x224)+_0x1b2f66 in MK['additionalMaps'])_0x441a31[_0x47ba7c(0x1fd)](_0x47ba7c(0x224)+_0x1b2f66);if(_0x47ba7c(0x20b)+_0x1b2f66 in MK[_0x47ba7c(0x25f)])_0x199b26['push'](_0x47ba7c(0x20b)+_0x1b2f66);if('snippetsouter'+_0x1b2f66 in MK[_0x47ba7c(0x25f)])_0x4a32e6[_0x47ba7c(0x1fd)](_0x47ba7c(0x217)+_0x1b2f66);}if(_0x4a32e6[_0x47ba7c(0x239)]>0x0)this['_generateOuterMaps'](_0x3fe45d);if(_0x4fd09b['length']==0x0)throw Error(_0x47ba7c(0x214));for(var _0x145e48=0x0;_0x145e48<_0x3fe45d['length'];_0x145e48++){for(var _0x4e2a92=0x0;_0x4e2a92<_0x3fe45d[_0x145e48][_0x47ba7c(0x239)];_0x4e2a92++){var _0x2c8ded=_0x3fe45d[_0x145e48][_0x4e2a92];if(_0x2c8ded<0x10)this[_0x47ba7c(0x21c)](MK[_0x47ba7c(0x1e2)]['pick_random'](_0x4fd09b),_0x2c8ded,_0x145e48,_0x4e2a92);if(_0x2c8ded>=0x10&&_0x2c8ded<0x20)this[_0x47ba7c(0x21c)](MK[_0x47ba7c(0x1e2)]['pick_random'](_0x441a31),_0x2c8ded-0x10,_0x145e48,_0x4e2a92,0x3,0x5);if(_0x2c8ded>=0x20&&_0x2c8ded<0x30)this[_0x47ba7c(0x21c)](MK[_0x47ba7c(0x1e2)][_0x47ba7c(0x221)](_0x199b26),_0x2c8ded-0x20,_0x145e48,_0x4e2a92);if(_0x2c8ded>=0x40)this[_0x47ba7c(0x21c)](MK[_0x47ba7c(0x1e2)][_0x47ba7c(0x221)](_0x4a32e6),_0x2c8ded-0x40,_0x145e48,_0x4e2a92,0x3,0x5);}}return this;}[_0xf90017(0x22e)](_0x24c4eb,_0x25cab3,_0x51acda,_0x9a1cbd,_0x3b9b1f,_0x1ad246){var _0x5615f6=_0xf90017;if(!_0x24c4eb)throw Error(_0x5615f6(0x268));_0x1ad246=_0x1ad246||this[_0x5615f6(0x230)],_0x25cab3=_0x25cab3||0x0,_0x9a1cbd=_0x9a1cbd||0x0,_0x51acda=_0x51acda||_0x1ad246[_0x5615f6(0x240)],_0x3b9b1f=_0x3b9b1f||_0x1ad246[_0x5615f6(0x266)];var _0x22b6ae=[];for(var _0x25ae65=_0x25cab3;_0x25ae65<_0x51acda;_0x25ae65++){for(var _0x13eb32=_0x9a1cbd;_0x13eb32<_0x3b9b1f;_0x13eb32++){this[_0x5615f6(0x211)](_0x25ae65,_0x13eb32,_0x1ad246)==_0x24c4eb&&_0x22b6ae[_0x5615f6(0x1fd)]({'x':_0x25ae65,'y':_0x13eb32});}}return _0x22b6ae;}[_0xf90017(0x23b)](_0x4289f3,_0x38e059){var _0x60e805=_0xf90017;if(!_0x38e059)_0x38e059=_0x60e805(0x23c);if(!['bottom',_0x60e805(0x22c),_0x60e805(0x263),_0x60e805(0x1f4),'any'][_0x60e805(0x241)](_0x38e059))throw Error(_0x60e805(0x1da)+_0x38e059);var _0x14ad64=[];if(_0x38e059==_0x60e805(0x23c))_0x14ad64=this[_0x60e805(0x22e)](_0x4289f3);else for(var _0x5322c7=0x1;_0x14ad64[_0x60e805(0x239)]==0x0;_0x5322c7++){if(_0x38e059=='bottom')var _0x1b6b8b=0x0,_0x231753=this[_0x60e805(0x230)][_0x60e805(0x240)],_0x463f64=this['dataMap']['height']-_0x5322c7*this[_0x60e805(0x22f)](),_0xc9f16d=this[_0x60e805(0x230)][_0x60e805(0x266)];if(_0x38e059==_0x60e805(0x22c))var _0x1b6b8b=0x0,_0x231753=this['dataMap'][_0x60e805(0x240)],_0x463f64=0x0,_0xc9f16d=_0x5322c7*this[_0x60e805(0x22f)]();if(_0x38e059==_0x60e805(0x263))var _0x1b6b8b=0x0,_0x231753=_0x5322c7*this[_0x60e805(0x1dd)](),_0x463f64=0x0,_0xc9f16d=this[_0x60e805(0x230)]['height'];if(_0x38e059==_0x60e805(0x1f4))var _0x1b6b8b=this[_0x60e805(0x230)]['width']-_0x5322c7*this[_0x60e805(0x1dd)](),_0x231753=this[_0x60e805(0x230)][_0x60e805(0x240)],_0x463f64=0x0,_0xc9f16d=this[_0x60e805(0x230)][_0x60e805(0x266)];if(_0x1b6b8b<0x0||_0x231753>this[_0x60e805(0x230)][_0x60e805(0x240)]||_0x463f64<0x0||_0xc9f16d>this[_0x60e805(0x230)]['height'])break;_0x14ad64=this[_0x60e805(0x22e)](_0x4289f3,_0x1b6b8b,_0x231753,_0x463f64,_0xc9f16d);}return _0x14ad64;}[_0xf90017(0x1ee)](_0x185f37,_0x1d9186){var _0x3bec77=_0xf90017;const _0x403d71=this[_0x3bec77(0x23b)](_0x185f37,_0x1d9186);if(_0x403d71[_0x3bec77(0x239)]==0x0)return{'x':0x0,'y':0x0};return MK[_0x3bec77(0x1e2)][_0x3bec77(0x221)](_0x403d71);}['_placeSpecialLocation'](_0x4151ad,_0x4c9017){var _0x3fc90c=_0xf90017;this[_0x3fc90c(0x207)]();var _0x32c3db=this[_0x3fc90c(0x1ee)](_0x4151ad,_0x4c9017);return this[_0x3fc90c(0x21a)](_0x32c3db['x'],_0x32c3db['y'],_0x4151ad),_0x32c3db;}[_0xf90017(0x264)](_0x5028c5){return this['_placeSpecialLocation'](MK['ENTRANCE_REGION_ID'],_0x5028c5),this;}[_0xf90017(0x1e3)](_0x106257){var _0x6073c6=_0xf90017;return this['_placeSpecialLocation'](MK[_0x6073c6(0x202)],_0x106257),this;}[_0xf90017(0x246)](_0x197ae7){var _0x1fb408=_0xf90017;return MK[_0x1fb408(0x244)][_0x1fb408(0x246)](this[_0x1fb408(0x250)],_0x197ae7),this;}[_0xf90017(0x24c)](_0x15b96e){var _0x550a6a=_0xf90017;this[_0x550a6a(0x207)]();for(let _0x52a232 in this[_0x550a6a(0x227)][_0x550a6a(0x1e8)]){if(_0x15b96e!=null&&!_0x15b96e[_0x550a6a(0x241)](Number(_0x52a232)))continue;if([MK['ENTRANCE_REGION_ID'],MK[_0x550a6a(0x202)],MK[_0x550a6a(0x1e5)]]['contains'](Number(_0x52a232)))continue;for(let _0x4029fb of this[_0x550a6a(0x22e)](_0x52a232)){this[_0x550a6a(0x21a)](_0x4029fb['x'],_0x4029fb['y'],_0x52a232);}}return this;}[_0xf90017(0x23a)](_0x1d4d5c,_0x8870df,_0x1dc8ea){var _0x5dc303=_0xf90017;_0x8870df=!_0x8870df&&_0x8870df!==0x0?0x1:_0x8870df,_0x1dc8ea=_0x1dc8ea||_0x8870df;const _0x1bf7e5=MK[_0x5dc303(0x1e2)][_0x5dc303(0x1fa)](_0x8870df,_0x1dc8ea),_0x570e93=this[_0x5dc303(0x227)][_0x5dc303(0x1e8)][_0x1d4d5c];if(!_0x570e93)throw Error('drawDecorationXTimes:\x20Invalid\x20Region\x20Id:\x20'+_0x1d4d5c);for(let _0x2812e9=0x0;_0x2812e9<_0x1bf7e5;_0x2812e9++){const _0x3d4ac5=this['getPossibleLocations'](_0x1d4d5c);if(!_0x3d4ac5['length'])break;const _0x22272e=MK[_0x5dc303(0x1e2)][_0x5dc303(0x221)](_0x3d4ac5);this[_0x5dc303(0x21a)](_0x22272e['x'],_0x22272e['y'],_0x1d4d5c);}return this[_0x5dc303(0x206)](_0x1d4d5c),this;}[_0xf90017(0x21a)](_0x4c1cf1,_0x534fb0,_0x761a68){var _0x5b8021=_0xf90017;const _0x4c43de=this['assetsInfo'][_0x5b8021(0x1e8)][_0x761a68];if(!_0x4c43de)throw Error(_0x5b8021(0x228)+_0x761a68+'\x20but\x20this\x20region\x20Id\x20is\x20not\x20defined\x20on\x20the\x20Decoration\x20Map');const _0x32432d=MK['rng'][_0x5b8021(0x1fa)](_0x4c43de['n']-0x1);this['drawAsset'](_0x4c1cf1,_0x534fb0,_0x5b8021(0x1e8),_0x4c43de,_0x32432d);}[_0xf90017(0x235)](_0x468ac0,_0x22a579,_0xb49cce,_0x4f091a,_0x1e3e58){var _0x2725bc=_0xf90017,_0x2444ab=_0x4f091a['x'],_0x1ade63=_0x4f091a['y'],_0x3cbcab=_0x4f091a['w'],_0x4265c9=_0x4f091a['h'],_0x2325d7=_0x1e3e58*_0x3cbcab+_0x2444ab,_0x4bc073=_0x1ade63,_0x47f21b=(_0x1e3e58+0x1)*_0x3cbcab+_0x2444ab-0x1,_0x100977=_0x1ade63+_0x4265c9-0x1;this[_0x2725bc(0x256)](_0x468ac0,_0x22a579,_0xb49cce,_0x2325d7,_0x4bc073,_0x47f21b,_0x100977),this[_0x2725bc(0x24f)](_0x468ac0,_0x22a579,_0xb49cce,_0x2325d7,_0x4bc073,_0x47f21b,_0x100977);}[_0xf90017(0x207)](){var _0x529ea5=_0xf90017,_0x4e51d8=_0x529ea5(0x1e8);if(!MK['additionalMaps'][_0x4e51d8])throw Error(_0x529ea5(0x1fe));var _0x65ae91=MK[_0x529ea5(0x25f)][_0x4e51d8],_0x422dec=_0x65ae91['width'],_0x190999=_0x65ae91[_0x529ea5(0x266)];this['assetsInfo']={},this[_0x529ea5(0x227)][_0x529ea5(0x1e8)]={};function _0x2b432b(_0xf3543a,_0x1cdab3){var _0x3fa646=_0x529ea5,_0x2b8892=0x0,_0x7976c=_0x1cdab3;for(;$dungeonGenerator[_0x3fa646(0x211)](_0x2b8892,_0x7976c,_0x65ae91)==_0xf3543a;_0x2b8892++){}_0x2b8892-=0x1;for(;$dungeonGenerator[_0x3fa646(0x211)](_0x2b8892,_0x7976c,_0x65ae91)==_0xf3543a;_0x7976c++){}return{'w':_0x2b8892+0x1,'h':_0x7976c-_0x1cdab3};}function _0x3a2b07(_0xde495d,_0x2f25a5,_0x5f2ec5){var _0x2ff5b9=_0x529ea5;const _0x542bdf=MK['arrange'](_0x422dec)[_0x2ff5b9(0x238)](_0x9e00d3=>$dungeonGenerator['regionId'](_0x9e00d3,_0xde495d,_0x65ae91)==MK[_0x2ff5b9(0x1ec)]);if(_0x542bdf!=-0x1)return Math['floor'](_0x542bdf/_0x2f25a5)-0x1;for(var _0x5246b9=0x1;(_0x5246b9+0x1)*_0x2f25a5-0x1<_0x422dec;_0x5246b9++){var _0x362caa=_0x5246b9*_0x2f25a5,_0x3558d6=_0xde495d,_0x267efc=(_0x5246b9+0x1)*_0x2f25a5-0x1,_0x4fc83f=_0xde495d+_0x5f2ec5-0x1;if($dungeonGenerator[_0x2ff5b9(0x210)](_0x362caa,_0x3558d6,_0x267efc,_0x4fc83f,_0x65ae91))return _0x5246b9-0x1;}return 0x1;}for(var _0x4271c7=0x0;_0x4271c7<_0x190999;_0x4271c7++){var _0x35068c=this[_0x529ea5(0x211)](0x0,_0x4271c7,_0x65ae91);if(_0x35068c in this[_0x529ea5(0x227)][_0x529ea5(0x1e8)])continue;if(_0x35068c){var _0x561451=_0x2b432b(_0x35068c,_0x4271c7),_0x20a774=_0x3a2b07(_0x4271c7,_0x561451['w'],_0x561451['h']),_0x3eb88a={};_0x3eb88a[_0x529ea5(0x211)]=_0x35068c,_0x3eb88a['x']=_0x561451['w'],_0x3eb88a['y']=_0x4271c7,_0x3eb88a['w']=_0x561451['w'],_0x3eb88a['h']=_0x561451['h'],_0x3eb88a['n']=_0x20a774,this[_0x529ea5(0x227)][_0x529ea5(0x1e8)][_0x35068c]=_0x3eb88a;}}}[_0xf90017(0x1ef)](_0x2f3a78,_0x2ea57b){var _0x2c3b5d=_0xf90017;if(typeof _0x2f3a78==_0x2c3b5d(0x1d4)&&typeof _0x2ea57b=='number')MK['onUsePremiumFunctionAlert']('spawnPlayerAt(x,\x20y)');let _0x3bab6e=_0x2f3a78||_0x2c3b5d(0x23c),_0x59640e=_0x2ea57b||MK[_0x2c3b5d(0x1e5)];return this['spawnLocation']=this[_0x2c3b5d(0x1ee)](_0x59640e,_0x3bab6e),this;}[_0xf90017(0x248)](){var _0x41422f=_0xf90017;$dungeonGenerator['mapId']=$gameMap[_0x41422f(0x25e)](),!this[_0x41422f(0x204)]&&this[_0x41422f(0x1ef)](),this[_0x41422f(0x1dc)](),MK[_0x41422f(0x25a)](this[_0x41422f(0x230)],this[_0x41422f(0x204)]['x'],this['spawnLocation']['y']),this[_0x41422f(0x247)]();}['eraseRegionIdsAndShadows'](){var _0x5760f1=_0xf90017;this[_0x5760f1(0x206)](MK[_0x5760f1(0x24e)]),this[_0x5760f1(0x206)](MK['EXIT_REGION_ID']),this[_0x5760f1(0x26a)]();}[_0xf90017(0x26a)](){var _0x4d1e67=_0xf90017;for(var _0x366466=0x0;_0x366466<this[_0x4d1e67(0x230)][_0x4d1e67(0x240)];_0x366466++){for(var _0x4775b5=0x0;_0x4775b5<this[_0x4d1e67(0x230)][_0x4d1e67(0x266)];_0x4775b5++){var _0x485133=this[_0x4d1e67(0x261)](_0x366466,_0x4775b5,0x4);this[_0x4d1e67(0x230)][_0x4d1e67(0x1ff)][_0x485133]=0x0;}}}}var $dungeonGenerator=new DungeonGenerator();class MazeBuilderParams{['cutOffDeadEnds'](_0x315481){var _0xb327f0=_0xf90017;return $dungeonGenerator[_0xb327f0(0x22a)](_0x315481),this;}[_0xf90017(0x20e)](_0x597d44){var _0x89ef89=_0xf90017;return $dungeonGenerator[_0x89ef89(0x20e)](_0x597d44),this;}[_0xf90017(0x253)](){var _0x215f18=_0xf90017;return $dungeonGenerator[_0x215f18(0x253)](),$dungeonGenerator;}[_0xf90017(0x246)](_0x19e907){return $dungeonGenerator['makeWayOut'](_0x19e907),this;}}function _0x5f4c(_0x49e6fe,_0x1e1c32){_0x49e6fe=_0x49e6fe-0x1d3;var _0x391ef2=_0x391e[_0x49e6fe];return _0x391ef2;}class RandomWalkParams{constructor(){var _0x112bc9=_0xf90017;this['_start']=_0x112bc9(0x229),this[_0x112bc9(0x1e6)]=_0x112bc9(0x22c),this[_0x112bc9(0x262)]=!![],this[_0x112bc9(0x251)]=!![],this['_allowRevisit']=![],this[_0x112bc9(0x234)]=![];}[_0xf90017(0x1fc)](_0x117b4b){var _0x419a2d=_0xf90017;return this[_0x419a2d(0x1e4)]=_0x117b4b,this;}[_0xf90017(0x1df)](_0x5e845a){var _0x4816b7=_0xf90017;return this[_0x4816b7(0x1e6)]=_0x5e845a,this;}['allowGoingBack'](_0x422d59){var _0x1c95dd=_0xf90017;return this[_0x1c95dd(0x262)]=_0x422d59,this;}[_0xf90017(0x231)](_0x103ab9){var _0x2feb36=_0xf90017;return this[_0x2feb36(0x251)]=_0x103ab9,this;}[_0xf90017(0x24a)](_0x55584f){var _0x589a3b=_0xf90017;return this[_0x589a3b(0x255)]=_0x55584f,this;}[_0xf90017(0x253)](){var _0x2a3d2f=_0xf90017;if(!this[_0x2a3d2f(0x234)])$dungeonGenerator[_0x2a3d2f(0x1f5)](this);return $dungeonGenerator[_0x2a3d2f(0x253)](),this[_0x2a3d2f(0x234)]=!![],$dungeonGenerator;}[_0xf90017(0x246)](_0x3abcd3){var _0x27ee9f=_0xf90017;return!this['_generated']&&($dungeonGenerator[_0x27ee9f(0x1f5)](this),this['_generated']=!![]),$dungeonGenerator['makeWayOut'](_0x3abcd3),this;}}

if (PluginManager && PluginManager.registerCommand) {
    
    PluginManager.registerCommand('MK_RNGMaps_Dungeons', 'borderWidth', args => {
        $dungeonGenerator.borderWidth(Number(args.value));
    });
    
    PluginManager.registerCommand('MK_RNGMaps_Dungeons', 'Create Classical Maze', _ => {
        $dungeonGenerator.prims().generate();
    });
    
    PluginManager.registerCommand('MK_RNGMaps_Dungeons', 'Create Maze with Finetuning', args => {
        
        if (args.mode == 'Cut off, then Merge') {
            $dungeonGenerator.prims()
                .cutOffDeadEnds(Number(args.cutOffDeadEnds))
                .mergeDeadEnds(Number(args.mergeDeadEnds))
                .generate();
        } else {
            $dungeonGenerator.prims()
                .mergeDeadEnds(Number(args.mergeDeadEnds))
                .cutOffDeadEnds(Number(args.cutOffDeadEnds))
                .generate();
        }
    });
    
    PluginManager.registerCommand('MK_RNGMaps_Dungeons', 'Create Dungeon using Random Walk', args => {
        
        $dungeonGenerator.randomWalk()
            .start(args.Start)
            .exit(args.End)
            .allowRevisit(args.allowRevisit == 'true')
            .generate();
    });
    
    PluginManager.registerCommand('MK_RNGMaps_Dungeons', 'Create Road', args => {
        
        $dungeonGenerator.randomWalk()
            .start(args.Start)
            .exit(args.End)
            .allowGoingBack(false)
            .generate();
    });
    
    PluginManager.registerCommand('MK_RNGMaps_Dungeons', 'placeEntrance', args => {
        $dungeonGenerator.placeEntranceOn(args.Position);
    });
    
    PluginManager.registerCommand('MK_RNGMaps_Dungeons', 'placeExit', args => {
        $dungeonGenerator.placeExitOn(args.Position);
    });
    
    PluginManager.registerCommand('MK_RNGMaps_Dungeons', 'spawnPlayerAt', args => {
        $dungeonGenerator.spawnPlayerAt(args.direction, Number(args.regionId));
    });
    
    PluginManager.registerCommand('MK_RNGMaps_Dungeons', 'drawDecorations', args => {
        const ids = args.Ids
            ? args.Ids.split(',').map(id => Number(id))
            : null;
        $dungeonGenerator.drawDecorations(ids);
    });
    
    PluginManager.registerCommand('MK_RNGMaps_Dungeons', 'drawDecorationXTimes', args => {
        $dungeonGenerator.drawDecorationXTimes(Number(args.Id), Number(args.min), Number(args.max));
    });
    
    PluginManager.registerCommand('MK_RNGMaps_Dungeons', 'finalize', _ => {
        $dungeonGenerator.finalize();
    });
}

DungeonGenerator.prototype.setFloorId = function() {
    MK.onUsePremiumFunctionAlert("setFloorId");
}